(function(){function t(e,t,i,s){function f(){if(!i||!i.length)return!1;var e=Math.floor(o/86400),r=Math.floor((o-e*86400)/3600),f=Math.floor((o-e*86400-r*3600)/60),l=o-e*86400-r*3600-f*60,c=i.attr("data-descbefore")||"",h=i.attr("data-descbehind")||"",p=i.attr("data-daytxt")||"\u5929 ",d=i.attr("data-hourtxt")||":",v=i.attr("data-minutetxt")||":",m=i.attr("data-secondtxt")||"",g=!!i.attr("data-hour-mode");g&&(r=e*24+r,e=0);var y=a({day:e,day_txt:p,hour:n(r),hour_txt:d,minute:n(f),minute_txt:v,second:n(l),second_txt:m,desc_before:c,desc_behind:h});return i.html(y),typeof s.process=="function"&&s.process(t),o-=1,u-=1e3,t-=1e3,!0}if(!e||!t||t>e)return;s=s||{};var o=Math.floor((e-t)/1e3),u=r(e),a=$.tmpl($.trim($("#JsCountdownTpl").html()));typeof s.start=="function"&&s.start(),f(),setTimeout(function(){var t=f();if(!t)return;if(o>-1){var n=r(e)-u;n<0&&(n=0),setTimeout(arguments.callee,n)}else typeof s.end=="function"&&s.end()},1e3)}function n(e){return e=e.toString(),e.length<2?"0"+e:e}function r(e){return e-(new Date).getTime()}var e=window.Bang=window.Bang||{};e.startCountdown=t})(),function(){}(),function(){function i(e){var t=y(),n=m();if(n)$.isFunction(e)&&e(n);else{var r={url:"/shiyong/doGetProductlist",type:"POST",dataType:"json",data:{model_id:t},timeout:5e3,error:function(e,t){},success:function(r){r.errno?alert(r.errmsg):(n=g(t,s(r.result)),$.isFunction(e)&&e(n))}};$.ajax(r)}}function s(e){var t={product_default:{},product_map:{},attr_groups:e.attr_groups,attr_group_ids:[],attr_map_product:e.sku_map_product,product_attr_group:[],product_map_attr:{},treaty_days:[],treaty_days_promo:[]};$.each(e.attr_groups,function(e,n){var r=n.attr_value_list;t.attr_group_ids.push([]),$.each(r,function(e,n){t.attr_group_ids[t.attr_group_ids.length-1].push(n.attr_value_id)})});var n=!1,r=[];$.each(e.products,function(e,i){t.product_map[i.product_id]=i,i["stock_nums"]==0?r.push(i.product_id):i["stock_nums"]!=0&&!n&&(t.product_default=i,n=!0);var s=i.strategy_price;$.each(s,function(e,t){s[e]={total:t,per_day:tcb.formatMoney(t/e,2,0)}})}),$.each(e.sku_map_product,function(e,n){$.inArray(n,r)==-1&&(e=e.split("_"),t.product_attr_group.push(e),t.product_map_attr[n]=e),e=null});var i=e.treaty_days;return $.each(i,function(e,n){t.treaty_days.push({day:e,text:n});var r=["365","180","90"];tcb.inArray(e,r)>-1&&t.treaty_days_promo.unshift({day:e,text:n})}),e=null,t}function o(e){e=e||{};var t=$.tmpl($.trim($("#JsShiYongProductInfoTpl").html())),n=t(e);$(".block1 .block-inner").html(n),tcb.setImgElSize($(".product-pics .p-pic-shower img"),350,350)}function u(e){e=e?d(e):v();var t=e.productData,n=e.selectedTreatyDay,r=e.selectedAttrGroup,i=e.allAttrGroup,s=e.allAttrList,o=e.productNoneStock,u=$(".product-pics .p-pic-shower img");u.attr("src",t.thum_img),tcb.setImgElSize(u,350,350),a(r,i,s);var f=$(".prd-treaty-day .p-c-item"),l=f.filter(function(){return $(this).attr("data-val")==n}),c=f.filter(function(){return $(this).attr("data-other")});f.removeClass("p-c-curr"),l&&l.length==2?(l.addClass("p-c-curr"),c.find(".p-c-item-text").html(c.attr("data-default-text"))):(l=$(".prd-treaty-day-completely").find('[data-val="'+n+'"]').addClass("p-c-curr"),c.addClass("p-c-curr").find(".p-c-item-text").html(l.html())),$(".prd-pledge-amount").html(t.pledge_amount);var h=t.strategy_price[n];$(".prd-treaty-fee-amount").html(h.total),$(".prd-treaty-fee-per-day-amount").html(h.per_day);var p=$(".prd-buy"),m=p.attr("href")||"/shiyong/order";m=tcb.setUrl(m,{product_id:t.product_id,treaty_day:n}),p.attr("href",m),o?p.addClass("prd-buy-disabled"):p.removeClass("prd-buy-disabled"),E()}function a(e,t,n){if(!e||!e.length)return;var r=[],i=$.map(t,function(e){return e.join(",")}),s=f(e);for(var o=0;o<n.length;o++){r[o]=[];var u=n[o];for(var a=0;a<u.length;a++){var l=u[a];for(var c=0;c<s.length;c++){var h=s[c],p=[];p=p.concat(h.slice(0,o),l,h.slice(o+1)),$.inArray(p.join(","),i)>-1&&$.inArray(l,r[o])==-1&&r[o].push(l)}}}var d=$(".prd-price-attr");d.each(function(t){$(this).find(".p-c-item").each(function(n){var i=$(this),s=i.attr("data-id");i.removeClass("p-c-curr").removeClass("p-c-disabled").removeClass("p-c-disabled-hover"),$.inArray(s,r[t])==-1?i.addClass("p-c-disabled"):i.removeClass("p-c-disabled"),s===e[t]&&i.addClass("p-c-curr")})})}function f(e){var t=[],n=1;if(e instanceof Array){var r=[];for(var i=0;i<e.length;i++)e[i]instanceof Array?r[i]=e[i]:r[i]=[e[i].toString()],n*=r[i].length;var s=1;return $.each(r,function(e,r){var i=r.length;n/=i;if(e==0)$.each(r,function(e,r){for(var i=0;i<n;i++)t.push([r])});else{var o=0;for(var u=0;u<s;u++)$.each(r,function(e,r){for(var i=0;i<n;i++)t[o].push(r),o++})}s*=i}),t}return[]}function l(e,t){var n=[],r=m(),i=r.product_attr_group,s=c(),o=[],u=[];$.each(i,function(n,r){if(r[t]==e){var i=0;$.each(s,function(e,n){if(e==t)return;n==r[e]&&i++}),u.push(i),o.push(r)}});var a=Math.max.apply(Math,u),f=$.inArray(a,u);return n=o[f],n}function c(){var e=$(".prd-price-attr"),t=tcb.cache(n)||[];return t.length||e.each(function(e,n){var r=$(n).find(".p-c-curr"),i="";r&&r.length&&(i=r.attr("data-id")),t.push(i)}),t}function h(e,t){var n=l(e,t),r=c(),i=[],s=m(),o=s.attr_group_ids;return $.each(r,function(e,r){r!=n[e]&&t!=e?i[e]=o[e]:i[e]=n[e]}),i}function p(e){var t=e.attr("data-id"),n=e.closest(".prd-price-attr")[0],r=0,i=$(".prd-price-attr");return i.each(function(e,t){n==t&&(r=e)}),{cur_attr:t,cur_attr_line_pos:r}}function d(e,t){var n=v();return typeof e=="object"?$.each(e,function(e,t){n[e]=t}):(e=e===null?"null":e.toString(),n[e]=t),tcb.cache(r,n),n}function v(e){var t=null,n=tcb.cache(r)||{};return typeof e=="undefined"?t=n:t=typeof n[e]=="undefined"?n:n[e],t}function m(){var n=tcb.cache(t),r=tcb.cache(e)||{},i=r[n];return i}function g(t,n){if(!t)return;var r=tcb.cache(e)||{};return r[t]=n,tcb.cache(e,r),n}function y(){return tcb.cache(t)}function b(e){return tcb.cache(t,e)}function w(e){if(!e||!e.length)return;var t=e.find(".arrow-down");if(t&&t.length)t.addClass("arrow-up").removeClass("arrow-down"),$(".prd-treaty-day-completely").show();else{var n=e.find(".arrow-up");n.addClass("arrow-down").removeClass("arrow-up"),$(".prd-treaty-day-completely").hide()}}function E(){var e=$(".prd-treaty-day .p-c-item .arrow-up");e&&e.length&&e.addClass("arrow-down").removeClass("arrow-up"),$(".prd-treaty-day-completely").hide()}function S(){tcb.bindEvent(document.body,{".prd-price-attr .p-c-item":function(e){e.preventDefault();var t=$(this);if(t.hasClass("p-c-curr"))return;var n=m(),r=v(),i=p(t),s=n.attr_map_product,o={selectedAttrGroup:h(i.cur_attr,i.cur_attr_line_pos),allAttrGroup:n.product_attr_group,allAttrList:n.attr_group_ids,productData:r.productData,productNoneStock:!0},a=s[o.selectedAttrGroup.join("_")];a&&(o.productData=n.product_map[a],o.productNoneStock=!1),u(o)},".prd-price-attr .p-c-disabled":{mouseenter:function(e){$(this).addClass("p-c-disabled-hover")},mouseleave:function(e){$(this).removeClass("p-c-disabled-hover")}},".prd-treaty-day .p-c-item":function(e){e.preventDefault();var t=$(this),n=t.attr("data-val"),r=!!t.attr("data-other");r?w(t):(d("selectedTreatyDay",n),u())},".prd-buy-disabled":function(e){e.preventDefault()}})}function x(){var e=window.Zu=window.Zu||{};e.setModelId=b,e.getModelBucketDataAsync=i,e.renderProductUI=o,e.setProductAttrUI=a,e.setProductUIStatusData=d,e.bindProductEvent=S}var e="KEY_MODEL_ID_MAP_PRODUCT",t="KEY_MODEL_ID",n="KEY_CURRENT_SELECTED_ATTR_GROUP",r="KEY_PRODUCT_UI_STATUS_DATA";x()}(),$(function(){function n(e,n){var r=e.product_default,i=r.product_id,s={product:r,attr_groups:e.attr_groups,treaty_days_promo:e.treaty_days_promo,treaty_days_default:e.treaty_days_promo[0].day,treaty_days:e.treaty_days,product_title_short:n};t.renderProductUI(s);var o=e.product_map_attr[i],u=e.product_attr_group,a=e.attr_group_ids;t.setProductAttrUI(o,u,a),t.setProductUIStatusData({selectedAttrGroup:o,allAttrGroup:u,allAttrList:a,productData:r,selectedTreatyDay:s.treaty_days_default,productNoneStock:r.stock_nums>0?!1:!0})}var e=$(".page-shiyong-index");if(!e||!e.length)return;var t=window.Zu;tcb.bindEvent(document.body,{".liji-qiangzu":function(e){e.preventDefault();var r=$(this),i=r.attr("data-id");if(r.hasClass("liji-qiangzu-disabled"))return;t.setModelId(i),t.getModelBucketDataAsync(function(e){n(e,r.attr("data-title")),r.closest(".block").fadeOut()});var s="pc\u79df\u8d41",o="",u="";i=="6"?(o="\u79df6s",u="\u70b9\u51fb\u201c\u7acb\u5373\u62a2\u79df\u201d6s"):(o="\u79df6sp",u="\u70b9\u51fb\u201c\u7acb\u5373\u62a2\u79df\u201d6sP");var a=["_trackEvent",s,o,u,"",""];tcb.statistic(a)},".btn-go-back-model":function(e){e.preventDefault(),$(".block0").fadeIn()}}),t.bindProductEvent()}),$(function(){var e=$(".page-shiyong-order");if(!e.length)return;(function(){function u(e){var n=t;if(n&&n.length)$.isFunction(e)&&e(n);else{var r="/aj/doGetProvinceList";$.get(r,function(n){n=$.parseJSON(n);if(!n.errno){var r=n.result;t=r,$.isFunction(e)&&e(r)}})}}function a(e,t){var n=[];$.each(e,function(e,r){n.push('<option value="',r.province_id,'"'),t===r.province_name&&n.push(" selected"),n.push(">",r.province_name,"</option>")}),n=n.join(""),i.html(n),n?i.show():i.hide()}function f(e,t){if(!e)return;var i=n[e];if(i&&i.length)$.isFunction(t)&&p(i[0].city_id,function(e){t(i,e)});else{var s="/aj/doGetProvinceLinkage?province_id="+e;i=[],$.get(s,function(s){s=$.parseJSON(s);if(!s.errno){var o=s.result;$.each(o.city_list,function(e,t){i.push({city_id:t.city_id,city_name:t.city_name}),r[t.city_id]=t.area_list&&t.area_list.length?t.area_list:[]}),n[e]=i;if($.isFunction(t)){var u=[];i&&i.length&&(u=r[i[0].city_id]),t(i,u)}}else t([],[])})}}function l(e,t){e=e||[];var n=[];$.each(e,function(e,r){n.push('<option value="',r.city_id,'"'),t===r.city_name&&n.push(" selected"),n.push(">",r.city_name,"</option>")}),n=n.join(""),s.html(n),n?s.show():s.hide()}function c(e,t){e=e||[];var n=[];$.each(e,function(e,r){n.push('<option value="',r.area_id,'"'),t===r.area_name&&n.push(" selected"),n.push(">",r.area_name,"</option>")}),n=n.join(""),o.html(n),n?o.show():o.hide()}function h(e,t){if(!e)return;var r=n[e];if(r&&r.length)$.isFunction(t)&&p(r[0].city_id,function(e){t(r,e)});else{var i="/aj/doGetCityList?province_id="+e;$.get(i,function(i){i=$.parseJSON(i),i.errno||(n[e]=i.result,$.isFunction(t)&&(r=n[e],r&&r.length&&p(r[0].city_id,function(e){t(r,e)})))})}}function p(e,t){if(!e)return;var n=r[e];if(n&&n.length)$.isFunction(t)&&t(n);else{var i="/aj/doGetAreaList?city_id="+e;$.get(i,function(n){n=$.parseJSON(n),n.errno||(r[e]=n.result,$.isFunction(t)&&t(r[e]))})}}function d(e,t){if(!e||!$.isArray(t))return;var n;return $.each(t,function(t,r){if(e==r["province_name"])return n=r.province_id,!1}),n}function v(){u(function(e){var t=window.city_name;a(e,t);var n=d(t,e);n&&f(n,function(e,t){l(e),c(t)})}),tcb.bindEvent(document.body,{'[name="receiver_province_id"]':{change:function(e){var t=$(this),n=t.val();f(n,function(e,t){l(e),c(t)})}},'[name="receiver_city_id"]':{change:function(e){var t=$(this),n=t.val();p(n,function(e){c(e)})}}})}var e=!0,t=[],n={},r={},i=$('[name="receiver_province_id"]'),s=$('[name="receiver_city_id"]'),o=$('[name="receiver_area_id"]');v()})(),function(){function t(e){if(!e||!e.length)return!1;var t=!0,n=null,r=120,i=-20,s=e.find('[name="buyer_mobile"]'),o=e.find('[name="sms_code"]'),u=e.find('[name="receiver_name"]'),a=e.find('[name="receiver_address"]'),f=e.find('[name="receiver_mobile"]'),l=e.find('[name="agreement"]'),c=e.find(".btn-submit");s&&s.length&&tcb.validMobile($.trim(s.val()))||(s&&s.length&&(n=n?n:s,setTimeout(function(){s.shine4Error()},r)),t=!1),o&&o.length&&$.trim(o.val())||(o&&o.length&&(n=n?n:o,setTimeout(function(){o.shine4Error()},r)),t=!1),u&&u.length&&$.trim(u.val())||(u&&u.length&&(n=n?n:u,setTimeout(function(){u.shine4Error()},r)),t=!1),a&&a.length&&$.trim(a.val())||(a&&a.length&&(n=n?n:a,setTimeout(function(){a.shine4Error()},r)),t=!1),f&&f.length&&tcb.validMobile($.trim(f.val()))||(f&&f.length&&(n=n?n:f,setTimeout(function(){f.shine4Error()},r)),t=!1),l&&l.length&&l.prop("checked")||(l&&l.length&&(n=n?n:l,setTimeout(function(){l.closest(".agreement-row").shine4Error()},r)),t=!1),c&&c.length&&!c.hasClass("btn-disabled")||(c&&c.length&&(n=n?n:c),t=!1);if(!t){var h=n.closest(".step-block");$(document.body).animate({scrollTop:h.offset().top},r+i,function(){n.focus()})}return t}function n(){var e=$.tmpl($.trim($("#JsMZuAgreementConfirmTpl").html())),t=e();tcb.showDialog(t,"mobile-experience-agreement-wrap")}var e=$("#SubmitOrderForm");e.on("submit",function(e){e.preventDefault();var n=$(this);if(!t(n))return;$.post(n.attr("action"),n.serialize(),function(e){e=$.parseJSON(e);if(!e.errno){var t=e.result,n=t.order_id;window.location.href="/shiyong/cashier?order_id="+n}else alert(e.errmsg)})}),tcb.bindEvent(document.body,{'[name="agreement"]':function(e){var t=$(this);t.prop("checked")?$(".btn-submit").removeClass("btn-disabled"):$(".btn-submit").addClass("btn-disabled")},".trigger-show-zu-agreement":function(e){e.preventDefault(),n()},".btn-prd-buy-cancel":function(e){e.preventDefault(),$('[name="agreement"]').removeAttr("checked"),$(".btn-submit").addClass("btn-disabled"),tcb.closeDialog()},".btn-prd-buy-confirm":function(e){e.preventDefault(),$('[name="agreement"]').prop("checked","checked"),$(".btn-submit").removeClass("btn-disabled"),tcb.closeDialog()}})}(),function(){tcb.bindEvent(document.body,{"#MobileOrderMobile":{blur:function(e){var t=$(this),n=$.trim(t.val());if(tcb.validMobile(n)){var r=$('[name="receiver_mobile"]'),i=$.trim(r.val());tcb.validMobile(i)||r.val(n)}}},".pay-label":function(e){var t=$(this);if(t.hasClass("pay-label-checked"))return;t.addClass("pay-label-checked").siblings(".pay-label-checked").removeClass("pay-label-checked"),t.find('[name="pay_type"]').trigger("click")},".get-mobile-order-secode":function(e){e.preventDefault();var t=$(this),n=$('[name="buyer_mobile"]');if(!n||!n.length)return;var r=n.val();if(!tcb.validMobile($.trim(r))){n.shine4Error().focus();return}var i="/shiyong/doSendSmscode";$.post(i,{mobile:r},function(e){e=$.parseJSON(e),e.errno?alert(e.errmsg):(t.addClass("get-mobile-order-secode-disabled").html("60\u79d2\u540e\u518d\u6b21\u53d1\u9001"),tcb.distimeAnim(60,function(e){e<=0?t.removeClass("get-mobile-order-secode-disabled").html("\u83b7\u53d6\u9a8c\u8bc1\u7801"):t.html(e+"\u79d2\u540e\u518d\u6b21\u53d1\u9001")}))})}})}()}),function(){function t(){var e="hidden",t="active",n="disabled",r=$(".cashier-bd"),s=$(".ca-opt-info"),o=$(".cashier-mod"),u=$(".cashier-tab"),a=$("#pay_form"),f=$("#bank_code"),l=$(".pay-period-list"),c=$("#hb_by_stages"),h=$("#payrate"),p=$(".pay-button"),d=$(".pay-button-wx");u.on("click","li",function(){var n=$(this),r=n.attr("data-type"),i=n.attr("data-mod");u.find("li").removeClass(t),o.addClass(e),$("."+i+"-block").removeClass(e),u.find("li[data-mod='"+i+"']").addClass(t),f.val(r);if(r=="alipay_hb"){var s=l.find("."+t),a=s.attr("period")*1,p=s.attr("amount")*1,d=s.attr("payrate")*1;$("#amount").html("\u00a5"+p),h.html("\u00a5"+d),c.val(a)}else c.val(""),h.html("")}),l.on("click","li",function(){var e=$(this);e.siblings().removeClass(t),e.addClass(t);var n=e.attr("amount")*1,r=e.attr("payrate")*1,i=e.attr("period")*1;$("#amount").html("\u00a5"+n),h.html("\u00a5"+r),c.val(i)}),s.on("click",function(){r.slideToggle(500)}),d.on("click",function(){var e=$(this);if(e.hasClass(n)){window.alert("\u56e0\u8d85\u65f6\u672a\u652f\u4ed8\uff0c\u8be5\u8ba2\u5355\u5df2\u5173\u95ed");return}var t=$("#order_id").val();i(t,function(n,r){var i=e.parent().find(".error");n=="0"?window.location.replace("/shiyong/paysuc?order_id="+t):i.html(r)})}),p.on("click",function(){var e=$(this);if(e.hasClass(n)){window.alert("\u56e0\u8d85\u65f6\u672a\u652f\u4ed8\uff0c\u8be5\u8ba2\u5355\u5df2\u5173\u95ed");return}if($.trim($("#bank_code").val())=="alipay_hb"&&l.find("."+t).length==0){window.alert("\u8bf7\u9009\u62e9\u4e00\u79cd\u5206\u671f\u65b9\u5f0f");return}var r=f.val();if(r!="hdfk"){var s=tcb.showDialog($.trim($("#JsPaymentConfirmPanelTpl").html()),{className:"common-payment-confirm-panel-wrap",withClose:!1});s.wrap.off("click").on("click","span",function(e){var t=$(e.target).attr("data-hoom"),n=$("#order_id").val(),r=s.wrap.find(".error");switch(t){case"close":tcb.closeDialog();break;case"finish":i(n,function(e,t){e=="0"?window.location.replace("/shiyong/paysuc?order_id="+n):r.html(t)});break;case"reset":i(n,function(e,t){e=="0"?window.location.replace("/shiyong/paysuc?order_id="+n):tcb.closeDialog()})}})}a.submit()})}function n(){var t=$(".ca-status-mod");if(!t||!t.length)return;var n=t.attr("now").replace(/-/g,"/"),r=t.attr("begin").replace(/-/g,"/"),i=t.attr("pid"),s=((new Date(n)).getTime()||(new Date).getTime())*1,o=(new Date(r)).getTime()*1+(window.locked_time||900)*1e3;o>s&&e.startCountdown(o,s,$("#countdown"),{end:function(){window.location.reload()}})}function r(){var e=$("#bank_code").val(),t=$(".pay-period-list");if(e=="alipay_hb"){var n=t.find(".active"),r=n.attr("amount")*1,i=n.attr("payrate")*1;$("#amount").html("\u00a5"+r),$("#payrate").html("\u00a5"+i)}}function i(e,t){$.ajax({url:"/shiyong/getOrderStatus?order_id="+e,dataType:"json",error:function(){setTimeout(function(){i(e,t)},5e3)},success:function(e){t&&t(e.errno,e.errmsg)}})}var e=window.Bang=window.Bang||{};$(function(){var e=$(".page-order-pay");if(!e||!e.length)return;n(),t(),r()})}(),$(function(){var e=$(".page-shiyong-order-success");if(!e.length)return;(function(){function e(){var e=$(".js-pay-countdown");if(!e||!e.length)return;e.each(function(e,t){var n=$(t),r=window.curtime,i=n.attr("data-otime"),s=(window.locked_time||1800)*1e3;r=Date.parse(r.replace(/-/g,"/"))||(new Date).getTime(),i=Date.parse(i.replace(/-/g,"/"))||0;var o=i+s;if(r>o){window.location.href=window.location.href+"&status_close=1";return}Bang.startCountdown(o,r,n,{end:function(){window.location.reload()}})})}e()})(),function(){tcb.bindEvent(document.body,{".btn-pay-success":function(e){e.preventDefault();var t=$(this),n=t.attr("data-orderid"),r="/shiyong/doGetPayResult?order_id="+n;$.get(r,function(e){e=$.parseJSON(e),e.errno?alert("\u60a8\u7684\u652f\u4ed8\u72b6\u6001\u8fd8\u672a\u66f4\u65b0\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002"):window.location.replace("/shiyong/paysuc?order_id="+n)})}})}()});