function AddrSuggest(e,t){if(W(e).length==0)return null;t=t||{},this.obj=W(e),this.curObj=null,this.data=null,this.suglist=null,this.defsug=null,this.showNum=t.showNum||10,this.onSelect=t.onSelect||null,this.requireCity=t.requireCity||function(){return""},this.noDefSug=t.noDefSug||!1,this.zIndex=t.zIndex||999,this._cacheData={};var n,r=this;this.init=function(){var e=this;if(!AMap||!AMap.Map)return setTimeout(function(){e.init()},300),!1;var t="aMapContainer"+Math.ceil(Math.random()*1e4);W('<div id="'+t+'"></div>').appendTo(W("body")).hide(),n=new AMap.Map(t),this.createDropList(),this.createDefSug(),this.showDefaultTxt(),this.bindEvent()},this.bindEvent=function(){var e=this.obj;e.on("focus",function(){var e=W(this),t=e.attr("data-default")||"";r.setCurObj(e),r.resetSugListPos(r.suglist),r.resetSugListPos(r.defsug),t==e.val()?(e.val(""),r.noDefSug||r.defsug.show().css({"z-index":tcb.zIndex()})):e.val().length>0&&(r.fetchSug(e.val()),r.defsug.hide()),e.removeClass("default")}),e.on("blur",function(){var e=W(this),t=e.val(),n=e.attr("data-default")||"";t==""&&n&&(e.val(n),t=n),setTimeout(function(){r.suglist.hide()},160),t==n&&e.addClass("default"),r.defsug.hide()}),e.on("keyup",function(e){var t=W(this),n=t.attr("data-default")||"";r.setCurObj(t);if(e.keyCode==38)r.selectItem(-1);else if(e.keyCode==40)r.selectItem(1);else if(e.keyCode==13){var i=r.suglist.one(".on");i.length>0&&i.fire("click")}else t.val()!=""&&t.val()!=n?(r.fetchSug(t.val()),r.defsug.hide()):(r.suglist.hide(),r.noDefSug||r.defsug.show().css({"z-index":tcb.zIndex()}))}),e.on("input",function(e){var t=W(this),n=t.attr("data-default")||"";r.setCurObj(t);if(e.keyCode==38)r.selectItem(-1);else if(e.keyCode==40)r.selectItem(1);else if(e.keyCode==13){var i=r.suglist.one(".on");i.length>0&&i.fire("click")}else t.val()!=""&&t.val()!=n?(r.fetchSug(t.val()),r.defsug.hide()):(r.suglist.hide(),r.noDefSug||r.defsug.show().css({"z-index":tcb.zIndex()}))}),e.on("keypress",function(e){if(e.keyCode==13){var t=r.suglist.one(".on");t.length>0&&e.preventDefault()}}),r.suglist.delegate(".ui-addrsug-sugitem","click",function(e){var t=W(this).attr("data-name"),n=W(this).attr("data-whole"),i=r.getCurObj();i.val(n),r.suglist&&r.suglist.css("display")!="none"&&r.suglist.hide(),r.onSelect&&r.onSelect(n)})},this.showDefaultTxt=function(){var e=this.obj;e&&e.length>0&&e.forEach(function(e,t){var n=W(e),r=n.attr("data-default")||"";n.val()==""&&r&&n.val(r),n.addClass("default")})},this.getCurObj=function(){return this.curObj||this.obj},this.setCurObj=function(e){return this.curObj=e||this.obj,this.curObj},this.fetchSug=function(e){try{var t=r._cacheData[encodeURIComponent(r.requireCity()+"-"+e)];t?r.gotData(t):n.plugin(["AMap.Autocomplete"],function(){var t={city:r.requireCity()},n=new AMap.Autocomplete(t);AMap.event.addListener(n,"complete",function(t){r._cacheData[encodeURIComponent(r.requireCity()+"-"+e)]=t,r.gotData(t)}),n.search(e)})}catch(i){}},this.gotData=function(e){e&&e.tips?r.render(e.tips):r.suglist.hide()},this.createDropList=function(){var e=W('<div class="ui-addrsug-suglist">').appendTo(W("body")).hide();this.suglist=e,this.resetSugListPos(e)},this.resetSugListPos=function(e){var t=r.getCurObj(),n=t.getRect(),i=t.attr("data-sugwidth")-0;e.css({position:"absolute","z-index":tcb.zIndex(),width:i||n.width,left:n.left,top:n.top+n.height+2})},this.render=function(e){if(e.length>0){var t="";for(var n=0,r=Math.min(e.length,this.showNum);n<r;n++){var i=e[n];t+='<div class="ui-addrsug-sugitem" data-name="'+i.name+'" data-whole="'+i.district+i.name+'"><b>'+i.name+"</b><span>"+i.district+"</span></div>"}this.suglist.show().html(t).css({"z-index":tcb.zIndex()})}else this.suglist.hide()},this.selectItem=function(e){var t=this.suglist.one(".on");if(!e||e==1)if(t.length==0)this.suglist.query(".ui-addrsug-sugitem:first-child").addClass("on");else{t.removeClass("on");var n=t.nextSibling(".ui-addrsug-sugitem");n.length>0?n.addClass("on"):this.suglist.query(".ui-addrsug-sugitem:first-child").addClass("on")}else if(t.length==0)this.suglist.query(".ui-addrsug-sugitem:last-child").addClass("on");else{t.removeClass("on");var r=t.previousSibling(".ui-addrsug-sugitem");r.length>0?r.addClass("on"):this.suglist.query(".ui-addrsug-sugitem:last-child").addClass("on")}},this.createDefSug=function(){var e="\u53ef\u4ee5\u641c\u7d22\u60a8\u6240\u5728\u7684\u5c0f\u533a\u3001\u5199\u5b57\u697c\u6216\u6807\u5fd7\u6027\u5efa\u7b51",t=W('<div class="ui-addrsug-defsug">').appendTo(W("body")).hide();W('<div class="ui-addrsug-defitem"></div>').html(e).appendTo(t),this.defsug=t,this.resetSugListPos(t)},this.init()}(function(){function e(t){var n={wrap:"#citySelector",data:{cityid:"",citycode:"",cityname:"",areacode:"",areaname:"",quancode:"",quanname:""},hasarea:!0,hasquan:!0,autoinit:!0,urlhost:"",onInit:function(){},onCitySelect:function(e){},onAreaSelect:function(e){},onQuanSelect:function(e){}};t=t||{},t=QW.ObjectH.mix(n,t,!0),t.urlhost=t.urlhost||"http://"+location.host+"/";var r=this;r.options=t,r.data={};var i=e.prototype;typeof i.eventBind=="undefined"&&(i.setData=function(e,t,n){var r=this;if(QW.ObjectH.isObject(e))n=t,t=null;else{if(!QW.ObjectH.isString(e))return;e={key:t}}n?r.data=e:r.data=QW.ObjectH.mix(r.data,e,!0)},i.getData=function(){var e=this;return e.data},i.deleteData=function(e){var t=this,n=t.data;QW.ObjectH.isArray(e)&&QW.ObjectH.map(e,function(e){typeof n[e]!="undefined"&&delete n[e]}),QW.ObjectH.isString(e)&&typeof n[e]!="undefined"&&delete n[e]},i.getArea=function(e){var t=this,n=t.options.urlhost+"aj/get_area/?citycode="+e;t._removeAreaTrigger(),t._removeQuanTrigger(),setTimeout(function(){QW.loadJsonp(n,function(e){var n=e.result,r="";QW.ObjectH.isObject(n)&&QW.ObjectH.map(n,function(e,t){r+='<a href="javascript:;" code="'+t+'">'+e+"</a>"});if(r){r='<a href="javascript:;">\u5168\u90e8\u533a\u53bf</a>'+r;var i=t._getAreaTrigger();i.show(),i.query(".select-list").html(r)}})},160)},i.getQuan=function(e,t){var n=this,r=n.options.urlhost+"aj/get_areaquan/?citycode="+e+"&areacode="+t;n._removeQuanTrigger(),setTimeout(function(){QW.loadJsonp(r,function(e){var t=e.result,r="";QW.ObjectH.isObject(t)&&QW.ObjectH.map(t,function(e,t){r+='<a href="javascript:;" code="'+t+'">'+e+"</a>"});if(r){r='<a href="javascript:;">\u5168\u90e8\u5546\u5708</a>'+r;var i=n._getQuanTrigger();i.show(),i.query(".select-list").html(r)}})},160)},i.getWrap=function(){var e=this;if(e.wWrap)return e.wWrap;var t=QW.ObjectH.isObject(e.options.wrap)?e.options.wrap:W(e.options.wrap);return e.wWrap=t},i._getCityTrigger=function(){var e=this;if(e.wCityTrigger)return e.wCityTrigger;var t=e.getWrap(),n=t.query(".sel-city");return e.wCityTrigger=n},i._setCityData=function(e,t,n){var r=this,i=r._getCityTrigger();i.attr("code",t),i.one(".sel-txt").html(n),r.setData({cityid:e,citycode:t,cityname:n},!0)},i._getAreaTrigger=function(){var e=this;if(e.wAreaTrigger)return e.wAreaTrigger;var t=e.getWrap(),n=t.query(".sel-quxian");if(!n.length){var r='<div class="area-sel sel-quxian mr-10" style="display:none;"><span class="sel-txt">\u9009\u62e9\u533a\u53bf</span><span class="icon icon-arrow pngfix"></span><div class="sel-quxian-pannel select-pannel" style="display:none;"><h3>\u533a\u53bf\u5217\u8868<span class="close city_close" title="\u5173\u95ed"></span></h3><div class="select-list"></div></div></div>';n=W(r),e.getWrap().appendChild(n)}return e.wAreaTrigger=n},i._setAreaData=function(e,t){var n=this,r=n._getAreaTrigger();r.attr("code",e),r.query(".sel-txt").html(t),n.setData({areacode:e,areaname:t})},i._removeAreaTrigger=function(){var e=this,t=e._getAreaTrigger();t.removeNode(),delete e.wAreaTrigger},i._getQuanTrigger=function(){var e=this;if(e.wQuanTrigger)return e.wQuanTrigger;var t=e.getWrap(),n=t.query(".sel-shangquan");if(!n.length){var r='<div class="area-sel sel-shangquan mr-10" style="display:none;"><span class="sel-txt">\u9009\u62e9\u5546\u5708</span><span class="icon icon-arrow pngfix"></span><div class="sel-shangquan-pannel select-pannel" style="display:none;"><h3>\u5546\u5708\u5217\u8868<span class="close city_close" title="\u5173\u95ed"></span></h3><div class="select-list"></div></div></div>';n=W(r),e.getWrap().appendChild(n)}return e.wQuanTrigger=n},i._setQuanData=function(e,t){var n=this,r=n._getQuanTrigger();r.attr("code",e),r.query(".sel-txt").html(t),n.setData({quancode:e,quanname:t})},i._removeQuanTrigger=function(){var e=this,t=e._getQuanTrigger();t.removeNode(),delete e.wQuanTrigger},i._selectCity=function(){var e=this,t=e._getCityTrigger(),n=new CityPanel(t);n.on("selectCity",function(t){var n=t.city.trim(),r=t.name.trim(),i=t.cityid.trim();e._setCityData(i,n,r),e.options.hasarea&&e.getArea(n);var s=e.data;typeof e.options.onCitySelect=="function"&&e.options.onCitySelect(s)})},i.eventBind=function(){var e=this,t=e.getWrap();e._selectCity(),t.on("click",function(t){var n=W(this),r=t.target,i=W(r),s=e._getAreaTrigger(),o=e._getQuanTrigger();if(s.contains(r)||s[0]===r){var u=s.query(".select-pannel");u.fadeIn(100),i.hasClass("close")&&u.hide();if(i[0].nodeName.toLowerCase()==="a"){var a=i.attr("code"),f=i.html();a?e._setAreaData(a,f):(s.attr("code",""),s.query(".sel-txt").html("\u9009\u62e9\u533a\u53bf"),e.deleteData(["areacode","areaname"])),u.hide(),e.deleteData(["quancode","quanname"]);var l=e.data;e.options.hasquan&&e.getQuan(l.citycode,a),typeof e.options.onAreaSelect=="function"&&e.options.onAreaSelect(l)}}else if(o.contains(r)||o[0]===r){var u=o.query(".select-pannel");u.fadeIn(100),i.hasClass("close")&&u.hide();if(i[0].nodeName.toLowerCase()==="a"){var a=i.attr("code"),f=i.html();a?e._setQuanData(a,f):(o.attr("code",""),o.query(".sel-txt").html("\u9009\u62e9\u5546\u5708"),e.deleteData(["quancode","quanname"])),u.hide();var l=e.data;typeof e.options.onQuanSelect=="function"&&e.options.onQuanSelect(l)}}}),W(document.body).on("click",function(t){var n=t.target,r=W(n),i=e._getAreaTrigger();!i.contains(n)&&i[0]!==n&&i.query(".select-pannel").hide();var s=e._getQuanTrigger();!s.contains(n)&&s[0]!==n&&s.query(".select-pannel").hide()})},i.init=function(){var e=this;e.eventBind();var t=e.options.data,n=e._getCityTrigger(),r=t.citycode?t.citycode:n.attr("code"),i=t.cityname?t.cityname:n.query(".sel-txt").html();e.setData({citycode:r,cityname:i}),e.options.hasarea&&e.getArea(r),t.areacode&&t.areaname&&(e._setAreaData(t.areacode,t.areaname),e.options.hasquan&&e.getQuan(r,t.areacode)),t.quancode&&t.quanname&&e._setQuanData(t.quancode,t.quanname),typeof e.options.onInit=="function"&&e.options.onInit(e.getData())}),r.options.autoinit&&r.init()}window.bang=window.bang||{},bang.AreaSelect=e})(),function(){function e(){this.init.apply(this,arguments)}e.prototype=function(){return{init:function(e){var t=this;CustEvent.createEvents(this);var n="";this.element=W(e);if(t.element&&!("placeholder"in document.createElement("input"))&&(n=t.element.attr("placeholder"))){var r=W('<label for="'+this.element.attr("id")+'"></label>').addClass("ele4phtips")[0];t.element.parentNode().insertBefore(r,t.element[0]);var i=function(e,t){e.style.opacity?e.style.opacity=t/100:e.style.filter="Alpha(opacity="+t+")"},s=function(){t.element.val()?r.innerHTML="":(i(r,0),r.innerHTML=n)};t.element.on("keyup",function(){s()}).on("focus",function(){s()}).on("blur",function(){t.element.val()||(i(r,100),r.innerHTML=n)}),t.element.val()||(r.innerHTML=n)}}}}(),QW.provide({PlaceHolder:e})}();var DateTime=function(e,t){function i(e,t){e=e||[];var n=e.length,r="",i="";return e.forEach(function(e,o){var u=e.date;r+='<span class="date-item'+(n===1?" date-curr":"")+(u.is_able?"":" date-disabled")+'" data-value="'+u.value+'">'+u.text+"</span>",t[u.value]=e.time,o||(i=s(e.time))}),[r,i]}function s(e){var t="";return e.length&&e.forEach(function(e,n){t+='<span class="time-item'+(e.is_able?"":" time-disabled")+'" data-value="'+e.value+'">'+e.text+"</span>"}),t}var n=".ui-datetime{position:absolute;z-index:9000;left:0;top:0;width:260px;background:#fff;border:1px solid #ccc;}.ui-datetime .date-box{border-bottom:1px solid #bbb}.ui-datetime .time-box{}.ui-datetime .date-item,.ui-datetime .time-item{display:inline-block;_zoom:1;padding:5px;border:1px solid #ddd;white-space:nowrap;word-break:keep-all;cursor:pointer; margin:4px;}.ui-datetime .date-curr{border-color:#81C900;background-color:#FAF2DB}.ui-datetime .time-curr{border-color:#81C900;background-color:#FAF2DB}.ui-datetime .date-disabled,.ui-datetime .time-disabled{border-color:#eee;background:#f0f0f0; color:#aaa;cursor:not-allowed;}",r=this;this.box=null,this.el=null,this.conf=Object.mix({remote:"",remoteDateTime:[],dateList:[{text:(new Date).getMonth()+1+"-"+(new Date).getDate(),value:(new Date).getMonth()+1+"-"+(new Date).getDate()}],timeList:[{text:"09:00",value:"09:00"},{text:"10:00",value:"10:00"},{text:"11:00",value:"11:00"},{text:"12:00",value:"12:00"},{text:"13:00",value:"13:00"},{text:"14:00",value:"14:00"},{text:"15:00",value:"15:00"},{text:"16:00",value:"16:00"},{text:"17:00",value:"17:00"},{text:"18:00",value:"18:00"}],onSelect:function(){}},t,!0),this.init=function(e,t){e=W(e),this.el=e;if(e.attr("type")!="text")return;Dom.insertCssText(n);var r=this;this.__create(function(t){e.on("focus",function(){r.show()}),W(document.body).on("click",function(e){e.target!=r.el[0]&&e.target!=t[0]&&!t.contains(e.target)&&r.hide()}),t.delegate(".date-item","click",function(){var e=W(this);if(e.hasClass("date-disabled"))return;e.addClass("date-curr").siblings(".date-curr").removeClass("date-curr");if(r.conf.remote&&r.conf.remoteTime){var n=r.conf.remoteTime[e.attr("data-value")];t.query(".time-box").html(s(n))}else t.query(".time-item").removeClass("time-curr").removeClass("time-disabled");var i=DateTime.getDateList(0,1)[0],o=(new Date).getHours();e.attr("data-value")==i.value&&t.query(".time-item").forEach(function(e){var t=W(e);t.attr("data-value").split(":")[0]-0<=o&&t.addClass("time-disabled")})}),t.delegate(".time-item","click",function(){if(W(this).hasClass("time-disabled"))return!1;W(this).addClass("time-curr").siblings(".time-curr").removeClass("time-curr"),t.one(".date-curr").length>0&&r.select()})})},this.__create=function(e){var t=this,n=t.conf.remote;if(n)t.getRemoteDateTime(function(n){n=n||[];var r=i(n,t.conf.remoteTime),s=r[0],o=r[1],u=W('<div class="ui-datetime"><div class="date-box">'+s+'</div><div class="time-box">'+o+"</div></div>").appendTo(W("body")).hide();t.box=u,typeof e=="function"&&e(u)});else{var r="",s="",o=t.conf.dateList;for(var u=0,a=o.length;u<a;u++)r+='<span class="date-item '+(a===1?"date-curr":"")+'" data-value="'+o[u].value+'">'+o[u].text+"</span>";var f=t.conf.timeList;for(var u=0,a=f.length;u<a;u++)s+='<span class="time-item" data-value="'+f[u].value+'">'+f[u].text+"</span>";var l=W('<div class="ui-datetime"><div class="date-box">'+r+'</div><div class="time-box">'+s+"</div></div>").appendTo(W("body")).hide();t.box=l,typeof e=="function"&&e(l)}},this.resetRemote=function(e,t){e=e||"",this.conf.remote=e,this.resetBoxHtml(t)},this.resetBoxHtml=function(e){var t=this;t.getRemoteDateTime(function(n){n=n||[];var r=i(n,t.conf.remoteTime),s=r[0],o=r[1],u=t.box;u&&u.length&&(u.query(".date-box").html(s),u.query(".time-box").html(o),typeof e=="function"&&e(u,n))})},this.getRemoteDateTime=function(e){var t=this,n=t.conf.remote;QW.Ajax.get(n,function(n){n=JSON.parse(n),n.errno||(t.conf.remoteTime={},t.conf.remoteDateTime=n.result,typeof e=="function"&&e(t.conf.remoteDateTime))})},this.select=function(){var e=this.box.query(".date-curr").attr("data-value")+" "+this.box.query(".time-curr").attr("data-value");this.el.val(e),this.hide(),typeof this.conf.onSelect=="function"&&this.conf.onSelect(e)},this.show=function(){var e=this.el.getRect(),t=this.el.attr("data-sugwidth")-0;this.box.css({left:e.left,top:e.top+e.height-1,width:t||e.width-2,"z-index":tcb.zIndex()}).show()},this.hide=function(){this.box.hide()},this.init(e,t)};DateTime.getDateList=function(e,t){var n=["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"];e=e||0,t=t||1;var r=[];for(var i=0;i<t;i++){var s=new Date((new Date).getTime()+864e5*(e+i)),o=s.getMonth()+1,u=s.getDate(),a=s.getDay(),f=s.getFullYear(),l=f+"-"+(o<10?"0"+o:o)+"-"+(u<10?"0"+u:u),c=n[a];e+i==0?c="\u4eca\u5929":e+i==1?c="\u660e\u5929":e+i==2&&(c="\u540e\u5929"),r.push({text:c+"\u3000"+l,value:l})}return r},function(){function e(){this.init.apply(this,arguments)}e.prototype=function(){var e=function(e,t){e=Math.min(99,e),t=parseInt(t,10)||0,t++,t=Math.min(Math.max(1,t),e);var n=[];t>5&&e>10&&n.push('<a data-pn="0" href="#" class="first">\u9996\u9875</a>&nbsp;'),t>1&&n.push('<a data-pn="',t-2,'" href="#" class="pre">&#171;\u4e0a\u4e00\u9875</span></a>&nbsp;');var r,i;t>5?(r=t-4,t>e-5&&(r=e-9)):r=1,i=r+9,r=Math.max(r,1),i=Math.min(i,e);for(var s=r;s<=i;s++)s==t?n.push("<span>",s,"</span>&nbsp;"):n.push('<a data-pn="',s-1,'" href="#">',s,"</a>&nbsp;");return t<e&&n.push('<a data-pn="',t,'" href="#" class="next">\u4e0b\u4e00\u9875&#187;</a>&nbsp;'),t<e-5&&t>10&&n.push('<a data-pn="',e-1,'" href="#" class="last">\u5c3e\u9875</a>'),n.join("")};return{init:function(t,n,r){var i=this;CustEvent.createEvents(this),W(t).undelegate("a","click"),W(t).html(e(n,r)).delegate("a","click",function(r){r.preventDefault();var s=this.getAttribute("data-pn")||0;setTimeout(function(){W(t).html(e(n,s))},50),i.fire("pageChange",{pn:s-0})})}}}(),QW.provide({Pager:e})}(),function(){function t(t,i,s,o){function l(){if(!s||!s.length)return!1;var t=Math.floor(u/86400),r=Math.floor((u-t*86400)/3600),l=Math.floor((u-t*86400-r*3600)/60),c=u-t*86400-r*3600-l*60,h=s.attr("data-descbefore")||e.countdown_desc||"",p=s.attr("data-descbehind")||"",d=s.attr("data-daytxt")||"\u5929 ",v=s.attr("data-hourtxt")||":",m=s.attr("data-minutetxt")||":",g=s.attr("data-secondtxt")||"",y=!!s.attr("data-hour-mode");y&&(r=t*24+r,t=0);var b=f({day:t,day_txt:d,hour:n(r),hour_txt:v,minute:n(l),minute_txt:m,second:n(c),second_txt:g,desc_before:h,desc_behind:p});return s.html(b),typeof o.process=="function"&&o.process(i),u-=1,a-=1e3,i-=1e3,!0}if(!t||!i||i>t)return;o=o||{};var u=Math.floor((t-i)/1e3),a=r(t),f=W("#JsCountdownTpl").html().trim().tmpl();typeof o.start=="function"&&o.start(),l(),setTimeout(function(){var e=l();if(!e)return;if(u>-1){var n=r(t)-a;n<0&&(n=0),setTimeout(arguments.callee,n)}else typeof o.end=="function"&&o.end()},1e3)}function n(e){return e=e.toString(),e.length<2?"0"+e:e}function r(e){return e-(new Date).getTime()}var e=window.Bang=window.Bang||{};e.countdown_desc="\u5269\u4f59",e.startCountdown=t}(),function(){function t(e){var t=this,n=t.getFilterParams(),r=Object.encodeURIJson(n),i=t._Cache[r];if(i)typeof e=="function"&&e(i);else{var s="/at/shop?"+r;QW.Ajax.get(s,function(n){n=n.evalExp(),!parseInt(n.errno,10)&&n.shop_data&&n.shop_data.length&&(n.shop_data.forEach(function(e){e["shop_ico"].indexOf("pinpailogo")==-1&&(e.shop_ico=tcb.imgThumbUrl(e.shop_ico,140,140))}),i=n,t.setCache(r,i)),typeof e=="function"&&e(i)})}}function n(e){var t=this;e&&t.setFilterParams("pn",0);var n="";t.getShopListData(function(e){e?n=o(e,t.options.tpl.shop_list):n='<div class="no-data-merrepair">\u62b1\u6b49\uff0c\u6682\u65f6\u6ca1\u6709\u627e\u5230\u7b26\u5408\u60a8\u8981\u6c42\u7684\u5e97\u94fa</div>';if(n===null)return;t.wList.html(n),typeof t.options["onAfter"]=="function"&&t.options.onAfter(t),t.renderShopListPager(function(e){t.setFilterParams("pn",e),t.renderShopList()})})}function r(e,t,n){var r=this;typeof e=="function"&&(t=e,e=null),e=e||r.wPageNav;if(!e.length)return;var i=r.getFilterParams(),s=parseInt(i.pn,10);if(!n&&s)return;var o=Object.encodeURIJson(i),u=r.getCache(o);if(!u)return;var a=Math.ceil(u.page_count/i.pagesize),f=e.query(".pages");if(a==1){f.hide().html("");return}f.show();var l=new Pager(f,a,s);l.on("pageChange",function(e){t=t||h,typeof t=="function"&&t(e.pn)})}function i(e,t){var n=this;e&&(n._Cache[e]=t)}function s(e){var t=this;return e?t._Cache[e]:t._Cache}function o(e,t){var n=null,r=e;r.shop_data.forEach(function(e){e["shop_ico"].indexOf("pinpailogo")==-1&&(e.shop_ico=tcb.imgThumbUrl(e.shop_ico,140,140))});var i=W(t||"");if(i&&i.length){var s=i.html().trim().tmpl();n=s(r)}return n}function u(e){var t=this,n=t.FilterParams||{};return e?n[e]:n}function a(e,t){var n=this;n.FilterParams=n.FilterParams||{},n.FilterParams[e]=t}function f(e){var t=this,n="panel-modeMapindex",r=t.createBigMap(n,e);t.getShopListData(function(e){if(!e)return;var i=e.shop_data||[];i.forEach(function(e,t){if(!e.map_longitude||!e.map_latitude)return!1;var n=new AMap.Marker({id:"MapMarker"+t,position:new AMap.LngLat(e.map_longitude,e.map_latitude),icon:{stc:"https://p.ssl.qhmsg.com/t01647448c59c844934.png"}.stc,offset:{x:-13,y:-36}});n.setMap(r);var i=new AMap.InfoWindow({isCustom:!0,autoMove:!0,offset:new AMap.Pixel(72,-245),content:W("#JsShopListMapModeShopCardTpl").html().tmpl({shop_name:e.shop_name,addr:e.addr_detail,service_tags:e.main.subByte(40,"..."),qid:e.qid,shop_addr:e.shop_addr,online_txt:e.is_online=="on"?"\u7acb\u5373\u54a8\u8be2":"\u79bb\u7ebf\u7559\u8a00"}),size:new AMap.Size(349,166)});AMap.event.addListener(n,"click",function(){i.open(r,n.getPosition())}),t==0&&r.setCenter(new AMap.LngLat(e.map_longitude,e.map_latitude))}),t.renderShopListPager(W("#"+n),function(e){t.setFilterParams("pn",e),t.showMap(!0)},!0)})}function l(e,t){var n=this;e=e||"panel-modeMapindex";if(t)return n.Map&&n.Map.clearMap&&n.Map.clearMap(),n.Map;var r={className:"panel panel-tom01 map-container-wrap",btn_name:"\u5173\u95ed",wrapId:e},i=n.getFilterParams("pn"),s=W("#JsShopListMapModeTpl").html().trim().tmpl()(),o=tcb.alert("\u5730\u56fe\u6a21\u5f0f",s,r,function(){return n.Map&&n.Map.destroy&&n.Map.destroy(),n.Map=null,n.MapPanel=null,n.setFilterParams("pn",i),!0});n.Map=new AMap.Map("mode_map_container",{view:new AMap.View2D({zoom:11,rotation:0})}),n.Map.plugin(["AMap.ToolBar","AMap.OverView","AMap.Scale"],function(){var e=new AMap.OverView;n.Map.addControl(e);var t=new AMap.ToolBar(-100,0);t.autoPosition=!1,n.Map.addControl(t);var r=new AMap.Scale;n.Map.addControl(r)});var u=W("#"+e);return tcb.bindEvent(u,{".close":function(e){try{e.preventDefault(),n.Map.clearInfoWindow(),n.Map.destroy(),n.Map=null}catch(e){}},".shop-card-close":function(e){e.preventDefault();try{n.Map.clearInfoWindow()}catch(t){}},".qim-go-talk":function(e){try{o.hide(),n.Map.clearInfoWindow(),n.Map.destroy(),n.Map=null}catch(t){}}}),n.Map}function c(){var e=this;tcb.bindEvent(e.wWrap[0],{".sort-type li a":function(t){t.preventDefault();var n=W(this);n.ancestorNode("li").addClass("active").siblings(".active").removeClass("active"),e.setFilterParams("type_id",n.attr("data-type")),e.renderShopList(!0)},".filter-check .chkbox":function(t){var n=W(this),r=n.attr("name");n.attr("checked")?r==="is_bzj"?e.setFilterParams(r,"1"):e.setFilterParams(r,"on"):r==="is_bzj"?e.setFilterParams(r,"0"):e.setFilterParams(r,"off"),e.renderShopList(!0)},".btn-mode-map":function(t){t.preventDefault(),e.showMap()}})}function h(){}var e=window.Bang=window.Bang||{};e.ShopList=function(o){function m(){var e=d.wWrap=W(d.options.selector.wrap);d.wList=e.query(d.options.selector.list||".shop-list"),d.wSort=e.query(".sort-type a"),d.wFilter=e.query('.filter-check [type="checkbox"]'),d.wMapMode=e.query(".btn-mode-map"),d.Map=null,d.wPageNav=e.query(".shop-list-pagination"),d.wFilterExtend=W(d.options.selector.extend_filter_wrap),d.eventBind()}var p={selector:{wrap:".shop-list-wrap",extend_filter_wrap:""},tpl:{shop_list:"#JsShopListTpl"},data:{},onBefore:h,onAfter:h};o=o||{},o=QW.ObjectH.mix(p,o,!0);var d=this;d.FilterParams={city_id:o.data.city_id||"",area_id:o.data.area_id||"",quan_id:o.data.quan_id||"",service_id:o.data.service_id||"",type_id:o.data.type_id||"",online:o.data.online||"on",cuxiao:o.data.cuxiao||"off",is_bzj:o.data.is_bzj||"0",tag:o.data.tag||"",pagesize:o.data.pagesize||15,pn:o.data.pn||0,lng:o.data.lng||"",lat:o.data.lat||""},d._Cache={},d.options=o,d.data={};var v=e.ShopList.prototype;typeof v.eventBind=="undefined"&&(v.eventBind=c,v.getShopListData=t,v.renderShopList=n,v.renderShopListPager=r,v.getFilterParams=u,v.setFilterParams=a,v.showMap=f,v.createBigMap=l,v.setCache=i,v.getCache=s),m()}}(),function(){function e(e){var t=!1;return e.length?(e.hasClass("form-disabled")&&(t=!0),t):!0}function t(e){if(!e.length)return;e.addClass("form-disabled")}function n(e){if(!e.length)return;e.removeClass("form-disabled")}window.Shangmen=window.Shangmen||{},QW.ObjectH.mix(window.Shangmen,{IndexPicSlider:function(){function o(){var n=r%e.length;W(".btn-list li").removeClass("cur"),W(".slide-box").animate({scrollLeft:n*t},i,function(){W(".btn-list li").item(n).addClass("cur")},QW.Easing.easeBoth)}function u(i){function u(){t=W(".slide-box").getSize().width,W(".slide-box .slide-list").css("width",t*n),e.css("width",t)}r=window.location.href.queryUrl("start")||0,e=W(".section-0 .top-pic"),n=e.length,u(),W(".btn-list li").on("click",function(){r=W(this).attr("data-sn")-0,clearInterval(s),o(),i||(s=setInterval(function(){r++,o()},5e3))}),e.show(),W(".slide-box")[0].scrollLeft=r*t,i||(s=setInterval(function(){r++,o()},5e3)),W(window).on("resize",function(){u(),o()})}var e,t,n,r=0,i=500,s=null;return{start:u,runPicAnim:o}}()}),tcb.isFormDisabled=tcb.isFormDisabled||e,tcb.setFormDisabled=tcb.setFormDisabled||t,tcb.releaseFormDisabled=tcb.releaseFormDisabled||n}(),Dom.ready(function(){function t(e,t){var n=this;this.meBox=W(e);if(!this.meBox.length)return;this.config=t||{},this.btnPrev=this.meBox.query(".slide-go-left"),this.btnNext=this.meBox.query(".slide-go-right"),this.innerBox=this.meBox.query(".slide-inner"),this.items=this.meBox.query(".slide-item"),this.listBox=this.meBox.query(".slide-list"),this.itemNum=this.meBox.query(".slide-item").length,this.ctrlBox=this.meBox.query(".slide-ctrl"),this.innerBoxWidth=this.innerBox.getRect().width,this.autoRunTimer=null,this.init=function(){var e=this,t=e.items;t&&t.length&&(e.itemWidth=t.getRect().width+parseInt(t.css("margin-left"),10)+parseInt(t.css("margin-right"),10),e.listBox.css({width:e.itemWidth*t.length}),e.config.showCtrl&&e.creatCtrl(),e.config.autoRun&&e.autoRun()),this.bindEvent()},this.resetBoxSize=function(){var e=this;e.items=e.meBox.query(".slide-item");var t=e.items;t&&t.length&&(e.itemWidth=t.getRect().width+parseInt(t.css("margin-left"),10)+parseInt(t.css("margin-right"),10),e.listBox.css({width:e.itemWidth*t.length}),e.config.showCtrl&&e.creatCtrl(),e.config.autoRun&&e.autoRun())},this.bindEvent=function(){var e=this,t=this.config;e.btnPrev.on("click",function(n){n.preventDefault();var r=W(this);if(r.attr("data-animating"))return;r.attr("data-animating","1"),e.innerBox.animate({scrollLeft:e.innerBox[0].scrollLeft-e.innerBoxWidth},t.animTime||300,function(){setTimeout(function(){r.attr("data-animating","")},200)},QW.Easing.easeOut)}),e.btnNext.on("click",function(n){n.preventDefault();var r=W(this);if(r.attr("data-animating"))return;r.attr("data-animating","1"),e.innerBox.animate({scrollLeft:e.innerBox[0].scrollLeft+e.innerBoxWidth},t.animTime||300,function(){setTimeout(function(){r.attr("data-animating","")},200)},QW.Easing.easeOut)}),e.meBox.delegate(".ctrl-item","click",function(t){t.preventDefault(),W(this).addClass("ctrl-curr").siblings(".ctrl-curr").removeClass("ctrl-curr");var n=W(this).attr("data-sn")||0;e.go(n)}),e.meBox.on("mouseenter",function(t){clearInterval(e.autoRunTimer)}),e.meBox.on("mouseleave",function(n){t.autoRun&&e.autoRun()})},this.go=function(e){var t=this.config;e=e||0,this.innerBox.animate({scrollLeft:0+this.innerBoxWidth*e},t.animTime||300,function(){},QW.Easing.easeOut)},this.autoRun=function(){var e=this,t=this.config;e.autoRunTimer=setInterval(function(){var t=e.meBox.query(".ctrl-curr").attr("data-sn")||0;nextSn=t-0+1,nextSn>e.itemNum-1&&(nextSn=0),e.meBox.query('.ctrl-item[data-sn="'+nextSn+'"]').addClass("ctrl-curr").siblings(".ctrl-curr").removeClass("ctrl-curr"),e.go(nextSn)},typeof t.autoRun=="number"?t.autoRun:5e3)},this.creatCtrl=function(e){if(this.ctrlBox.query(".ctrl-item").length||this.items.length<2)return;str="";for(var t=0,n=this.items.length;t<n;t++)str+='<span class="ctrl-item '+(t==0?"ctrl-curr":"")+'" data-sn="'+t+'"></span>';this.ctrlBox.html(str)},this.init()}var e=window.Shangmen;W(".slide-box").length>0&&e.IndexPicSlider.start(window.location.href.queryUrl("stop")=="true"),$(".wx-img-show .slide-go-left").on("click",function(e){$(".wx-img-show .tit").html("\u90ae\u5bc4\u7ef4\u4fee\u5f88\u5b89\u5fc3")}),$(".wx-img-show .slide-go-right").on("click",function(e){$(".wx-img-show .tit").html("\u4e0a\u95e8\u7ef4\u4fee\u5f88\u5feb\u6377")}),new t(".wx-img-show .slide-wrap",{animTime:500})}),Dom.ready(function(){function n(){var e={selector:{wrap:".shop-list-wrap",extend_filter_wrap:""},tpl:{shop_list:"#JsShopList2Tpl"},data:{city_id:"bei_jing",area_id:0,quan_id:0,service_id:"",type_id:"",online:"off",cuxiao:"off",is_bzj:0,tag:"",pagesize:10,pn:0,lng:"",lat:""},onBefore:function(){},onAfter:function(e){if(!t){var n=W(".sm-shop-block-left").getRect().top;tcb.gotoTop.goPlace(n-3)}t=!1}};return new window.Bang.ShopList(e)}function s(){function n(e){e==null?W(".addr-search-err").show():(W(".addr-search-err").hide(),r.setFilterParams("lng",e.lng),r.setFilterParams("lat",e.lat),r.setFilterParams("area_id",""),i._setAreaData("","\u9009\u62e9\u533a\u53bf"),r.renderShopList(!0))}function s(e,t){W('<div id="geoMapBox"></div>').appendTo(W("body")).hide();var n=new AMap.Map("geoMapBox");n.plugin(["AMap.Geocoder"],function(){MGeocoder=new AMap.Geocoder({city:W("#JsAreaSelectWrap .sel-city .sel-txt").html()||"",radius:1e3,extensions:"all"}),AMap.event.addListener(MGeocoder,"complete",function(e){var n=null;e&&e.resultNum>0&&(n={lng:e.geocodes[0].location.lng,lat:e.geocodes[0].location.lat}),t(n)}),MGeocoder.getLocation(e)})}var e=W("#addrSearchForm"),t=e.one('[name="addr"]');e.bind("submit",function(e){e.preventDefault();var r=t.val();r==""||r==t.attr("data-default")?(t.focus(),QW.NodeW&&QW.NodeW.shine4Error&&QW.NodeW.shine4Error(t)):s(r,n)}),t.on("focus",function(){W(".addr-search-err").hide()}),window.aaaaa=new AddrSuggest(t,{showNum:6,onSelect:function(e){s(e,n)},requireCity:function(){return W("#JsAreaSelectWrap .sel-city .sel-txt").html()||""}})}var e=W(".page-shangmen-diannao");if(!e||!e.length)return;tcb.bindEvent(e[0],{".shop-list .list-item":{mouseenter:function(e){var t=W(this);t.addClass("list-item-hover")},mouseleave:function(e){var t=W(this);t.removeClass("list-item-hover")}}});var t=!0,r=n(),i=new bang.AreaSelect({wrap:"#JsAreaSelectWrap",hasquan:!1,autoinit:!0,urlhost:"http://"+location.host+"/",onInit:function(e){r.setFilterParams("city_id",e.citycode),r.setFilterParams("area_id",e.areacode),r.setFilterParams("quan_id",e.quancode),r.setFilterParams("lng",""),r.setFilterParams("lat","");var t=W('#addrSearchForm [name="addr"]');t.val(t.attr("data-default")).addClass("default"),r.renderShopList(!0)},onCitySelect:function(e){r.setFilterParams("city_id",e.citycode),r.setFilterParams("area_id",""),r.setFilterParams("quan_id",""),r.setFilterParams("lng",""),r.setFilterParams("lat","");var t=W('#addrSearchForm [name="addr"]');t.val(t.attr("data-default")).addClass("default"),r.renderShopList(!0)},onAreaSelect:function(e){r.setFilterParams("city_id",e.citycode),r.setFilterParams("area_id",e.areacode),r.setFilterParams("quan_id",""),r.setFilterParams("lng",""),r.setFilterParams("lat","");var t=W('#addrSearchForm [name="addr"]');t.val(t.attr("data-default")).addClass("default"),r.renderShopList(!0)},onQuanSelect:function(e){r.setFilterParams("city_id",e.citycode),r.setFilterParams("area_id",e.areacode),r.setFilterParams("quan_id",e.quancode),r.setFilterParams("lng",""),r.setFilterParams("lat","");var t=W('#addrSearchForm [name="addr"]');t.val(t.attr("data-default")).addClass("default"),r.renderShopList(!0)}});s()}),Dom.ready(function(){function e(e){var t=W(".slide-box2"),n=t.getRect().width;t.animate({scrollLeft:e*n},800,function(){},QW.Easing.easeBoth)}function t(){var e=W(".slide-box2"),t=e.query(".slide-list"),n=e.query(".slide-item"),r=e.getSize().width,i=n.length;t.css("width",r*i),n.css("width",r),n.removeClass("slide-item-hide")}function n(){var e=W(".top-banner"),t=e.query(".item");t.item(0).css({display:"block","z-index":9}).siblings(".item").hide(),setTimeout(function(){var n=arguments;t=e.query(".item");var r=t.item(0),i=t.item(1);i.css({display:"block","z-index":8,opacity:1}),r.animate({opacity:{from:1,to:0}},1e3,function(){r.css({display:"none","z-index":0}).appendTo(e),i.css({"z-index":9}),setTimeout(n.callee,4e3)})},4e3)}function r(){var e="/shangmen/aj_get_fault_group";$.get(e,{group_type:1},function(e){try{e=$.parseJSON(e);if(!e.errno){var t=e.result,n=W("#JsFaultListTpl").html().trim().tmpl(),r=n({list:t});$(".js-fault-list").html(
r);var i=[];for(var s=0;s<t.length;s++)i.push(t[s].list);var o=W("#JsSubFaultListTpl").html().trim().tmpl(),u=o({list:i});$(".js-sub-fault-list").html(u)}}catch(a){}})}function i(e,t){var n=this;this.meBox=W(e);if(!this.meBox.length)return;this.config=t||{},this.btnPrev=this.meBox.query(".slide-go-left"),this.btnNext=this.meBox.query(".slide-go-right"),this.innerBox=this.meBox.query(".slide-inner"),this.items=this.meBox.query(".slide-item"),this.listBox=this.meBox.query(".slide-list"),this.itemNum=this.meBox.query(".slide-item").length,this.ctrlBox=this.meBox.query(".slide-ctrl"),this.innerBoxWidth=this.innerBox.getRect().width,this.autoRunTimer=null,this.init=function(){var e=this,t=e.items;t&&t.length&&(e.itemWidth=t.getRect().width+parseInt(t.css("margin-left"),10)+parseInt(t.css("margin-right"),10),e.listBox.css({width:e.itemWidth*t.length}),e.config.showCtrl&&e.creatCtrl(),e.config.autoRun&&e.autoRun()),this.bindEvent()},this.resetBoxSize=function(){var e=this;e.items=e.meBox.query(".slide-item");var t=e.items;t&&t.length&&(e.itemWidth=t.getRect().width+parseInt(t.css("margin-left"),10)+parseInt(t.css("margin-right"),10),e.listBox.css({width:e.itemWidth*t.length}),e.config.showCtrl&&e.creatCtrl(),e.config.autoRun&&e.autoRun())},this.bindEvent=function(){var e=this,t=this.config;e.btnPrev.on("click",function(n){n.preventDefault();var r=W(this);if(r.attr("data-animating"))return;r.attr("data-animating","1"),e.innerBox.animate({scrollLeft:e.innerBox[0].scrollLeft-e.innerBoxWidth},t.animTime||300,function(){setTimeout(function(){r.attr("data-animating","")},200)},QW.Easing.easeOut)}),e.btnNext.on("click",function(n){n.preventDefault();var r=W(this);if(r.attr("data-animating"))return;r.attr("data-animating","1"),e.innerBox.animate({scrollLeft:e.innerBox[0].scrollLeft+e.innerBoxWidth},t.animTime||300,function(){setTimeout(function(){r.attr("data-animating","")},200)},QW.Easing.easeOut)}),e.meBox.delegate(".ctrl-item","click",function(t){t.preventDefault(),W(this).addClass("ctrl-curr").siblings(".ctrl-curr").removeClass("ctrl-curr");var n=W(this).attr("data-sn")||0;e.go(n)}),e.meBox.on("mouseenter",function(t){clearInterval(e.autoRunTimer)}),e.meBox.on("mouseleave",function(n){t.autoRun&&e.autoRun()})},this.go=function(e){var t=this.config;e=e||0,this.innerBox.animate({scrollLeft:0+this.innerBoxWidth*e},t.animTime||300,function(){},QW.Easing.easeOut)},this.autoRun=function(){var e=this,t=this.config;e.autoRunTimer=setInterval(function(){var t=e.meBox.query(".ctrl-curr").attr("data-sn")||0;nextSn=t-0+1,nextSn>e.itemNum-1&&(nextSn=0),e.meBox.query('.ctrl-item[data-sn="'+nextSn+'"]').addClass("ctrl-curr").siblings(".ctrl-curr").removeClass("ctrl-curr"),e.go(nextSn)},typeof t.autoRun=="number"?t.autoRun:5e3)},this.creatCtrl=function(e){if(this.ctrlBox.query(".ctrl-item").length||this.items.length<2)return;str="";for(var t=0,n=this.items.length;t<n;t++)str+='<span class="ctrl-item '+(t==0?"ctrl-curr":"")+'" data-sn="'+t+'"></span>';this.ctrlBox.html(str)},this.init()}if(!W(".page-shangmen-shouji").length)return;tcb.bindEvent(document.body,{".type-tab a":function(t){t.preventDefault();var n=W(this),r=n.attr("data-pos");n.addClass("tab-selected").siblings(".tab-selected").removeClass("tab-selected"),e(r)},".fault-list .item-more":function(e){e.preventDefault();var t=W(".fault-more-list");if(!t.attr("data-oheight")){var n=t.getRect().height;n?t.attr("data-oheight",n):(n=t.show().getRect().height,t.attr("data-oheight",n).hide())}var r=t.attr("data-oheight");t.css("display")=="none"?t.show().css("height",0).addClass("anim-box").animate({height:r},300,function(){t.removeClass("anim-box")}):t.addClass("anim-box").animate({height:0},300,function(){t.removeClass("anim-box").hide()})},".main-fault-list .item":{mouseenter:function(e){e.preventDefault(),$(this).addClass("item-cur").siblings().removeClass("item-cur"),$(".sub-fault-list .sub-fault-box").eq($(this).index()).addClass("sub-fault-box-cur").siblings().removeClass("sub-fault-box-cur")}}}),t(),W(window).on("resize",function(){t()}),n(),$(".wx-img-show .slide-go-left").on("click",function(e){$(".wx-img-show .tit").html("\u90ae\u5bc4\u7ef4\u4fee\u5f88\u5b89\u5fc3")}),$(".wx-img-show .slide-go-right").on("click",function(e){$(".wx-img-show .tit").html("\u4e0a\u95e8\u7ef4\u4fee\u5f88\u5feb\u6377")}),new i(".wx-img-show .slide-wrap",{animTime:500})}),Dom.ready(function(){if(!W(".page-shangmen-order").length)return;(function(){function r(n,r){var o=i();o.pn=n||0,o.async=1;if(t[Object.encodeURIJson(o)]){var u=t[Object.encodeURIJson(o)],f=W("#smDaodianShopTpl").html().trim().tmpl();html=f(u),W(".search-mod-rs").html(html),r&&s(Math.ceil(u.page_count/e)),window.__currListData=u,a()}else QW.Ajax.get("/client/search/",o,function(e){e=QW.JSON.parse(e),e.shop_data=e.data;if(!e.shop_data&&o["pn"]==0)W(".no-result").show();else if(e.shop_data.length==0&&o["pn"]==0)W(".no-result").show();else{W(".no-result").hide(),t[Object.encodeURIJson(o)]=e;var n=W("#smDaodianShopTpl").html().trim().tmpl();html=n(e),W(".search-mod-rs").html(html),r&&s(Math.ceil(e.page_count/o.pagesize)),r&&W(".search-rs-num").html(e.page_count),window.__currListData=e,a()}})}function i(){return{keyword:W(".daodian-shop-kw").html()||"",city_id:W(".area-select-wrap .sel-city").attr("code")||"",area_id:W(".area-select-wrap .sel-quxian").attr("code")||"",type_id:W(".search-mod-hd li.curr").attr("data-type")||0,pagesize:10,show_mode:"product"}}function s(e,t,n){var t=t||"smRepairPager";if(e==1){W("#"+t+" .pages").hide().html("");return}W("#"+t+" .pages").show();var i=parseInt(location.hash.replace("#","").queryUrl("pn"),10)||0,s=new Pager(W("#"+t+" .pages"),e,i);s.on("pageChange",function(e){n=n||r,n(e.pn,!1,!1),W('.detail-cnt[data-for="daodian"]')[0].scrollIntoView(!0)})}function u(){o=new AMap.Map("smMapWrap",{view:new AMap.View2D({zoom:8,rotation:0})})}function a(){o||u(),o.clearMap();var e=n.shop_data||[];e.forEach(function(e,t){t==0&&o.setCenter(new AMap.LngLat(e.map_longitude,e.map_latitude));var n=new AMap.Marker({id:"mapMarker"+t,position:new AMap.LngLat(e.map_longitude,e.map_latitude),icon:{stc:"https://p.ssl.qhmsg.com/t01a55fed81341959b4.png"}.stc,offset:{x:-13,y:-36}});n.setMap(o)})}function f(){var e=null,t=tcb.alert("\u5730\u56fe\u6a21\u5f0f",'<div id="mode_map" ><div id="mode_map_container" style="width:700px;height:480px"></div></div>',{width:700,btn_name:"\u5173\u95ed",wrapId:"panel-modeMapindex"},function(){return e=null,!0});document.getElementById("mode_map_container").innerHTML="",e=new AMap.Map("mode_map_container",{view:new AMap.View2D({zoom:10,rotation:0})}),e.plugin(["AMap.ToolBar","AMap.OverView","AMap.Scale"],function(){var t=new AMap.OverView;e.addControl(t);var n=new AMap.ToolBar(-100,0);n.autoPosition=!1,e.addControl(n);var r=new AMap.Scale;e.addControl(r)}),W(document.body).delegate("#panel-modeMapindex span.close","click",function(t){try{t.preventDefault(),e.clearInfoWindow(),e=null}catch(t){}}),W(document.body).delegate(".mode-map a.close","click",function(t){t.preventDefault(),e.clearInfoWindow()}),W(document.body).delegate(".qim-go-talk","click",function(){t.hide(),e=null});var r=n.shop_data||{};r.forEach(function(t,n){n==0&&e.setCenter(new AMap.LngLat(t.map_longitude,t.map_latitude));var r=new AMap.Marker({id:"mapMarker"+n,position:new AMap.LngLat(t.map_longitude,t.map_latitude),icon:{stc:"https://p.ssl.qhmsg.com/t01647448c59c844934.png"}.stc,offset:{x:-13,y:-36}});r.setMap(e);var i=new AMap.InfoWindow({isCustom:!0,autoMove:!0,offset:new AMap.Pixel(70,-290),content:W("#indexMapInfoTpl_sm").html().tmpl({shop_name:t.shop_name,addr:t.addr_detail||t.s_addr_detail,service_tags:t.main.subByte(40,"..."),qid:t.qid,shop_addr:t.shop_addr}),size:new AMap.Size(349,204)});AMap.event.addListener(r,"click",function(){i.open(e,r.getPosition())})})}function l(e,t){var n=window._ServiceData||{},r=n[e];r?t(r):QW.Ajax.get("/shangmen/aj_get_zydata",{fault_id:e},function(n){n=QW.JSON.parse(n);if(!n.errno){var i=n.result;r={youji_city:[],shangmen_city:i.shangmen_data,daodian_city:i.daodian_data,select_list:i.zy_data.select_list,service_list:i.zy_data.info_kv_list,express_not_support:{2:i.show_beijing_express_flags||{},4:i.show_shanghai_express_flags||{}}},window._ServiceData[e]=r,t(r)}})}function c(){if(W("#citySelector").length){var e=window.location.href.queryUrl();new bang.AreaSelect({wrap:"#citySelector",hasquan:!1,autoinit:!0,urlhost:"http://"+location.host+"/",onInit:function(){},onCitySelect:function(e){r(0,!0)},onAreaSelect:function(e){r(0,!0)},onQuanSelect:function(e){var t=e.areacode,n=e.quancode,r=n?window.URL_ROOT+"t/aj_tuangou/?city="+window.cur_citycode+"&areaid="+t+"&quanid="+n:window.URL_ROOT+"t/aj_tuangou/?city="+window.cur_citycode+"&areaid="+t;QW.Ajax.get(r,function(e){try{var t=QW.JSON.parse(e),n={shop_huodong:t.result},r=W("#t_SetupsysShopTpl").html().trim().tmpl(),i=r(n);W(".dp-list-box table tbody").html(i)}catch(s){}})}}),W(".search-mod-hd li").on("click",function(){if(W(this).hasClass("curr"))return;W(this).addClass("curr").siblings().removeClass("curr"),r(0,!0)}),W(".see-big-map").on("click",function(e){e.preventDefault(),f()}),W(".detail-tab-item").on("click",function(e){W(this).addClass("curr").siblings().removeClass("curr");var t=W(this).attr("data-rel");W(".detail-cnt").hide(),W('.detail-cnt[data-for="'+t+'"]').show();try{t=="daodian"&&a()}catch(n){}}),W(".sm-zj-item").on("mouseenter",function(e){W(this).addClass("hover")}),W(".sm-zj-item").on("mouseleave",function(e){W(this).removeClass("hover")}),r(0,!0),u(),W(".detail-tab").show(),l(e.fault_id,function(e){e&&e.shangmen_city&&e.shangmen_city[window.__CurCityCode]?(W('.detail-tab-item[data-rel="shangmen"]').show().fire("click"),W('.detail-tab-item[data-rel="youji"]').hide()):(W('.detail-tab-item[data-rel="shangmen"]').hide(),W('.detail-tab-item[data-rel="youji"]').show().fire("click"))})}}var e=10,t={},n={},o=null;c()})()}),Dom.ready(function(){function t(){var e;tcb.bindEvent(".page-shangmen",{".right-question":function(t){t.preventDefault(),e=tcb.panel("",W("#questionContent").html(),{width:670,height:580,withShadow:!0,className:"panel panel-tom01 border8-panel pngfix q-pop-panel"})},".q-pop-panel":function(t){e&&e.hide()},".mask":function(t){e&&e.hide()},".cmt-p-prev":function(e){W(".u-cmt-box").animate({scrollLeft:W(".u-cmt-box")[0].scrollLeft-0-226},300)},".cmt-p-next":function(e){W(".u-cmt-box").animate({scrollLeft:W(".u-cmt-box")[0].scrollLeft-0+226},300)},".kf-xiaomeizi":function(t){t.preventDefault(),e=tcb.panel("",'<div class="question-pop"><p style="padding: 10px">\u5728\u7ebf\u5ba2\u670d\u6b63\u5fd9\uff0c<br/>\u5982\u9700\u54a8\u8be2\u8bf7\u60a8\u81f4\u7535 <em>4000-399-360</em> <br>\uff08\u5de5\u4f5c\u65f6\u95f49:00-19:00\uff09</p></div>',{withShadow:!0,className:"panel panel-tom01 border8-panel pngfix q-pop-panel"})}}),$("#ServiceExtendInfo").on("change","select",function(e){var t=W(this),n=t.ancestorNode(".curr-prd-box-extendinfo"),i=t.attr("name"),o=n.attr("data-for"),a=!0;t.nextSibling("select").length&&(a=!1);var l=0;t.previousSiblings("select").length&&(l+=t.previousSiblings("select").length),f(o,function(e){var i=[];n.query("select").map(function(e){i.push(W(e).val())});var o=e.service_list[i.join("|")];d(o);if(a)o&&(s(),r(o.id),u(),W("#promoContainer").css({visibility:"visible"}));else{var f=e.select_list,c=f[l+1],h=c.list,p='<option value="">'+c.option+"</option>";h.map(function(e){t.val()==e["pid"]&&(p+='<option value="'+e.id+'">'+e.name+"</option>")}),t.nextSibling("select").html(p),r()}})}),tcb.bindEvent(".page-shangmen-order",{".use-promo":function(e){e.preventDefault(),W(this).hide().siblings(".use-promo-txt").hide().siblings(".promo-box").show()},"#promoCode":{change:function(e){u()}},'[name="service_type"]':function(e){var t=W(".service-type:checked").val();s(),m(t),u()},".zy-ld-item":function(e){var t=W(this).attr("src"),n=t.replace(/cmt(\d+)\.jpg/ig,"cmt$1_b.jpg");tcb.panel("\u8bc4\u8bba\u8be6\u60c5",'<img src="'+n+'" alt="" width="320" />',{width:320,height:598})},"#showSJExtPrice":function(e){e.preventDefault(),tcb.panel("",W("#ZiyingSJExtPriceTpl").html().trim().tmpl()(),{})},".sm-sub-pre":function(e){e.preventDefault();var t=W(this).attr("data-mp");if(t==1){var n=tcb.queryUrl(window.location.search);n.showdetail="",window.location.href=tcb.setUrl(window.location.pathname,n)}else W(".section-pre").slideUp(500),W(".section-o-1").show()},".js-show-ncsj-protocol":function(e){e.preventDefault();var t=W("#ZiyingNeicunshengjiProtocolTpl").html().trim().tmpl()();tcb.panel("",t,{width:800,height:600,withShadow:!0,className:"panel panel-tom01 border8-panel pngfix ncsj-protocol-wrap-dialog"})},".js-show-fwsm-protocol":function(e){e.preventDefault();var t=W("#ZiYingFuWuShengMingTpl").html().trim().tmpl()();tcb.panel("",t,{width:800,height:600,withShadow:!0,className:"panel panel-tom01 border8-panel pngfix ncsj-protocol-wrap-dialog"})}})}function n(e){var t=window._ServiceData||{},n=t[e],r="";if(n){var i=n.select_list;r=W("#ZiyingServiceExtendInfoTpl").html().trim().tmpl()({select_list:i,fault_id:e})}var s=W("#ServiceExtendInfo");s.html(r)}function r(e){var t=W("#ServiceExtendInfo .curr-prd-box-extendinfo").attr("data-for"),n=e?l(t,e):"",r=e?c(t,e):"",i=e?h(t):"",s=W("#service_type_1");!n||S("shangmen")?(s.attr("disabled",!0),s.attr("checked",!1),s.ancestorNode("label").addClass("disabled")):(s.setAttr("disabled",!1),s.ancestorNode("label").removeClass("disabled"),n!==-1&&W("#smSptArea").html("\uff08"+n+"\uff09"));var o=W("#service_type_3");!r||S("daodian")?(o.attr("disabled",!0),o.attr("checked",!1),o.ancestorNode("label").addClass("disabled")):(o.attr("disabled",!1),o.ancestorNode("label").removeClass("disabled"),p(r));var u=W("#service_type_2");!i||S("youji")?(u.attr("disabled",!0),u.attr("checked",!1),u.ancestorNode("label").addClass("disabled")):(u.attr("disabled",!1),u.ancestorNode("label").removeClass("disabled")),m()}function i(e,t){e=e?parseFloat(e):0,e=e?e:0;var n=W('[name="youhui_code"]'),r=n.val().trim(),i=0,s=W("#promoYZ");if(!r){s.html(s.attr("data-placeholder")).removeClass("promo-succ").removeClass("promo-fail"),typeof t=="function"&&t(e,i);return}QW.Ajax.post("/aj/doGetYouhuiAmount",{youhui_code:r,service_type:1,price:e,product_id:W('[name="fault_id"]').val(),fuwu_type:W('[name="service_type"]').filter(function(e){return W(e).attr("checked")}).val()},function(n){try{n=QW.JSON.parse(n);if(n.errno)W("#promoYZ").html("\u62b1\u6b49\uff0c\u4f18\u60e0\u7801\u9a8c\u8bc1\u5931\u8d25\u3002").removeClass("promo-succ").addClass("promo-fail");else{i=n.result.promo_amount||0;var r=n.result.promo_per||0;r&&(i={promo_per:r}),typeof i=="object"?(r=i.promo_per,i=tcb.formatMoney(e*(100-r)/100,0,1)):i=tcb.formatMoney(i,0,1);var s="\u4f18\u60e0\u7801\u6709\u6548\uff0c\u5df2\u4f18\u60e0"+i+"\u5143~";r&&(s="\u4f18\u60e0\u7801\u6709\u6548\uff0c\u670d\u52a1\u53ef\u4eab\u53d7"+r+'\u6298\u4f18\u60e0<span class="red">\uff08\u4e0d\u5305\u542b\u52a0\u4eab\u670d\u52a1\uff09</span>'),e-=i,e=e<0?0:e,W("#promoYZ").html(s).removeClass("promo-fail").addClass("promo-succ")}typeof t=="function"&&t(e,i)}catch(o){typeof t=="function"&&t(e,i)}})}function s(e){e=e||v();if(!e)return;e.fault_type&&e["fault_type"]=="43"?(W(".ncsj-protocol-line").show(),W('#formOrder [type="submit"]').val("\u4e0b\u5355\u652f\u4ed8").attr("data-type","2")):(W(".ncsj-protocol-line").hide(),W('#formOrder [type="submit"]').val("\u7acb\u5373\u9884\u7ea6").attr("data-type","1")),W('[name="fault_id"]').val(e.id);var t=e.description?"\uff08"+e.description+"\uff09":"";W(".fw-bz").html(t),o(e),W(".yyinfo-box").hide()}function o(e){var t=e.value_added_server||[],n="";t&&t.length&&t.forEach(function(e){var t=window.__ExtendService[e];if(!t)return;n+='<div class="extend-service-label" data-plusprice="'+t.server_price+'" data-id="'+t.id+'">'+'<span class="checkbox"><input type="checkbox" name="value_added_selected[]" value="'+t.id+'"/></span>'+'<span class="txt">+'+t.server_name+"</span>"+"</div>"}),W(".product-extend-service").html(n)}function u(e){e=e||v();if(!e)return;var t,n=W(".service-type:checked").val();switch(n){case"1":t=e.price;break;case"2":t=e.youji_price;break;case"3":t=e.daodian_price}t=parseFloat(t||e.price),W("#showOrgPirce").html(e.original_price),W('[name="total_amount"]').val(e.price),i(t,function(e,n){W("#showPrice").html(e);var r=e;W(".extend-service-label").forEach(function(e){var t=W(e);if(t.hasClass("extend-service-label-checked")){var n=parseFloat(t.attr("data-plusprice"));r+=n}}),W(".total-price").html("\uffe5"+r),W('[name="real_amount"]').val(r),a(t,n)})}function a(e,t){t=t?t:0;var n=0,r=t>0?"#fe4b00":"#333";W(".product-price").html("\uffe5"+e.toFixed(2)),W(".discount-price").html("-\uffe5"+t.toFixed(2)).css("color",r),W(".product-extend-service .extend-service-label-checked").forEach(function(e){var t=parseFloat(W(e).attr("data-plusprice"));n+=t-0}),W(".extend-service-price").html("\uffe5"+n.toFixed(2))}function f(e,t){var n=window._ServiceData||{},r=n[e];r?t(r):QW.Ajax.get("/shangmen/aj_get_zydata",{fault_id:e},function(n){n=QW.JSON.parse(n);if(!n.errno){var i=n.result;r={youji_city:[],shangmen_city:i.shangmen_data,daodian_city:i.daodian_data,select_list:i.zy_data.select_list,service_list:i.zy_data.info_kv_list,express_not_support:{2:i.show_beijing_express_flags||{},4:i.show_shanghai_express_flags||{}}},window._ServiceData[e]=r,t(r)}})}function l(e,t){var n=!1,r=window._ServiceData||{},i=r[e];if(i){var s=W('[name="sm_city"]').val(),o=i.shangmen_city[s];o&&(typeof o[t]=="undefined"?n=!1:(n=o[t],n=n?n:-1))}return n}function c(e,t){var n=!1,r=window._ServiceData||{},i=r[e];if(i){var s=W('[name="sm_city"]').val();if(i.daodian_city&&i.daodian_city.city&&i.daodian_city.city[s]){var o=i.daodian_city.city[s];if(o[t]&&o[t].length){var u=o[t],a=i.daodian_city.store,f=[];for(var l=0;l<u.length;l++)a[u[l]]&&f.push(a[u[l]]);f.length&&(n=f)}}}return n}function h(e){var t=!1,n=window._ServiceData||{},r=n[e];if(r){var i=W("#ServiceExtendInfo select"),s=[];i.map(function(e){s.push(W(e).val())});var o=r.service_list[s.join("|")];o&&(t=!0)}return t}function p(e){var t=W(".yyinfo-box .daodian-addr"),n="";if(e&&e.length)for(var r=0;r<e.length;r++)n+='<label><input type="radio" name="dd_addr" value="'+e[r].store_id+'"/>'+e[r].store_area+" "+e[r].store_address+" "+e[r].store_name+"\uff0c\u8054\u7cfb\u4eba\uff1a"+e[r].manager_name+" "+e[r].store_tel+"</label>";t.html(n),e.length===1&&t.query('[name="dd_addr"]').first().attr("checked","checked")}function d(e){return e&&(window.CurProductInfoData=e),window.CurProductInfoData}function v(){return window.CurProductInfoData}function m(e){var t=W('[name="service_type"]'),n=t.map(function(e,t){return W(e).val()}),r=!1;n.contains(e)&&(W(".yyinfo-box").hide(),t.forEach(function(t){var n=W(t),i=n.val();e==i&&!n.attr("disabled")?(r=!0,n.attr("checked","checked"),W('.yyinfo-box[data-for="'+i+'"]').show(),i=="2"?(W('[name="bank_code"]').val("online"),g(!0)):(W('[name="bank_code"]').val("offline"),g())):n.removeAttr("checked")})),r||(W(".yyinfo-box").hide(),t.forEach(function(e){var t=W(e),n=t.val();!r&&!t.attr("disabled")?(r=!0,t.attr("checked","checked"),W(".yyinfo-box").hide(),W('.yyinfo-box[data-for="'+n+'"]').show(),n=="2"?(W('[name="bank_code"]').val("online"),g(!0)):(W('[name="bank_code"]').val("offline"),g())):t.removeAttr("checked")}),r||g())}function g(e){e=e||!1;var t=W("#ServiceExtendInfo .curr-prd-box-extendinfo").attr("data-for"),n=W('[name="fault_id"]').val(),r=window._ServiceData||{};r=r[t];var i=r?r.express_not_support:{},s=W(".choose-stations-service"),o=W(".show-stations-address");tcb.each(i,function(e,t){var r=s.query('[data-id="'+e+'"]');typeof t[n]!="undefined"&&!t[n]?r.hide():r.show()}),s.hide(),s.query(".active").removeClass("active"),o.hide(),o.query(".stations-to").html(""),W('[name="express_station_id"]').val(""),e&&s.show()}function y(e){if(!W(e).length)return!1;var t=new CityPanel(e);t.on("close",function(e){}),t.on("selectCity",function(e){var t=e.city.trim(),n=e.name.trim();W("#currCity").html(n).attr("data-city",t),W('[name="sm_city"]').val(t),QW.loadJsonp("/aj/getcookiecity?citycode="+t+"&cityname="+n,function(e){}),s();var i=v(),o=i?i.id:"";r(o),u()})}function b(){W('.yyinfo-box-sm [name="sm_addr"]').length&&(new PlaceHolder('.yyinfo-box-sm [name="sm_addr"]'),new AddrSuggest('.yyinfo-box-sm [name="sm_addr"]',{showNum:8,requireCity:function(){return W("#currCity").html().trim()||"\u5317\u4eac"}}));if(W('.yyinfo-box-sm [name="sm_time"]').length){new PlaceHolder('.yyinfo-box-sm [name="sm_time"]');var e=tcb.queryUrl(window.location.search);window.__ShangmenDateTime=new DateTime('.yyinfo-box-sm [name="sm_time"]',{remote:"/shangmen/doGetValidDate?type=1&valid=7&fault_type="+e.fault_id,onSelect:function(e){}})}W('.yyinfo-box-sm [name="buyer_mobile"]').length&&new PlaceHolder('.yyinfo-box-sm [name="buyer_mobile"]'),W('.yyinfo-box-sm [name="sms_code"]').length&&new PlaceHolder('.yyinfo-box-sm [name="sms_code"]')}function w(){if(W('.yyinfo-box-dd [name="sm_time"]').length){new PlaceHolder('.yyinfo-box-dd [name="sm_time"]');var e=tcb.queryUrl(window.location.search);window.__DaodianDateTime=new DateTime('.yyinfo-box-dd [name="sm_time"]',{remote:"/shangmen/doGetValidDate?type=3&valid=7&fault_type="+e.fault_id,onSelect:function(e){}})}W('.yyinfo-box-dd [name="buyer_mobile"]').length&&new PlaceHolder('.yyinfo-box-dd [name="buyer_mobile"]'),W('.yyinfo-box-dd [name="sms_code"]').length&&new PlaceHolder('.yyinfo-box-dd [name="sms_code"]')}function E(){W('.yyinfo-box-yj [name="sm_addr"]').length&&(new PlaceHolder('.yyinfo-box-yj [name="sm_addr"]'),new AddrSuggest('.yyinfo-box-yj [name="sm_addr"]',{showNum:8,requireCity:function(){return W("#currCity").html().trim()||"\u5317\u4eac"}}),W('.yyinfo-box-yj [name="sm_addr"]').on("change",function(e){var t=W(this),n=t.val(),r=W(".yyinfo-box-yj .sm-addr-tip");r&&r.length&&(n?r.show():r.hide())})),W('.yyinfo-box-yj [name="sm_receiver"]').length&&new PlaceHolder('.yyinfo-box-yj [name="sm_receiver"]'),W('.yyinfo-box-yj [name="buyer_mobile"]').length&&new PlaceHolder('.yyinfo-box-yj [name="buyer_mobile"]'),W('.yyinfo-box-yj [name="sms_code"]').length&&new PlaceHolder('.yyinfo-box-yj [name="sms_code"]')}function S(e){var t=window.__CloseService||{};return t.shangmen=t.shangmen||!1,t.youji=t.youji||!1,t.daodian=t.daodian||!1,t[e]}function x(){t();var n=window.location.href.queryUrl();W(".slide-box").length>0?e.IndexPicSlider.start(n["stop"]=="true"):W("#formOrder").length&&(b(),w(),E()),W(".citypanel_trigger").length&&y(".citypanel_trigger")}function T(){QW.Ajax.get("/shangmen/aj_get_fault_group",function(e){e=JSON.parse(e);if(!e.errno){var t=e.result,n=W("#JsOrderCate2Tpl").html().trim().tmpl()({list:t});W(".page-shangmen-order .cate-list-sub-inner").html(n);var r=window.location.href.queryUrl(),i=r.fault_id,s=W('.product-list .product-item[data-id="'+i+'"]');try{if(s.length){var o=s.attr("data-for");o&&W('.product-list .product-item[data-type="'+o+'"]').fire("click"),s.first().fire("click")}else W(".product-list .product-item").item(0).fire("click")}catch(u){}}else console.log(e.errmsg)})}if(!W(".page-shangmen-order").length)return;var e=window.Shangmen;window.__ShangmenDateTime,window.__DaodianDateTime,window._ServiceData=window._ServiceData||{},function(){function e(){var e=window.__ExtendService||"";e&&(e=JSON.parse(e)),window.__ExtendService={},e.forEach(function(e){window.__ExtendService[e.id]=e})}e()}(),function(){tcb.bindEvent(document.body,{".sel-other-issue":function(e){e.preventDefault(),W(".product-list").slideDown()},".addr-stations li":function(){var e=$(this),t="active";e.siblings().removeClass(t),e.addClass(t),W(".show-stations-address").show(),W(".stations-to").html(e.attr("data-station")+" "+e.attr("data-consignee")),W(".express_station_id").val(e.attr("data-id"))},".product-list .product-item":function(e){e.preventDefault();var t=W(this),i=t.attr("data-type"),o=t.attr("data-id"),a=t.attr("data-price"),l=t.attr("data-oprice"),c=t.html(),h=t.attr("data-extinfo");W(".fault-row .product-select").removeClass("product-select"),t.addClass("product-select");if(i){W(".product-list .sub-list").show(),W(".product-list .sub-list .product-item").hide(),W('.product-list .sub-list .product-item[data-for="'+i+'"]').show();return}t.ancestorNode(".top-list").length&&W(".product-list .sub-list").hide(),d({price:a,original_price:l,id:""}),s(),u(),r(),W("#currFault").html(c),W("#extInfo").html(h||""),W(".product-list").hide(),W(".curr-prd-box").show(),window.__ShangmenDateTime&&window.__ShangmenDateTime.resetRemote&&window.__ShangmenDateTime.resetRemote("/shangmen/doGetValidDate?type=1&valid=7&fault_type="+o),window.__DaodianDateTime&&window.__DaodianDateTime.resetRemote&&window.__DaodianDateTime.resetRemote("/shangmen/doGetValidDate?type=3&valid=7&fault_type="+o),f(o,function(e){n(o),W("#promoContainer").css({visibility:"hidden"});var t=W("#ServiceExtendInfo"),r=t.query("select");r.forEach(function(e){e.options.length==2&&(e.options.item(1).selected=!0,$(e).trigger("change"))}),r.length==1&&r[0].options.length==2&&t.query(".curr-prd-box-extendinfo").hide()})}})}(),function(){}(),function(){var e;tcb.bindEvent(document.body,{".inpt-secode-mobile, .inpt-secode, .ipt-pic-secode":{blur:function(){var e=W(this),t=e.val().trim();e.hasClass("inpt-secode-mobile")?tcb.validMobile(t)&&W(".inpt-secode-mobile").val(t):e.hasClass("ipt-pic-secode")?t&&W(".ipt-pic-secode").val(t):t&&W(".inpt-secode").val(t)}},".btn-get-secode":function(e){e.preventDefault();var t=W(this);if(t.hasClass("btn-get-secode-disabled"))return;var n=t.siblings(".inpt-secode-mobile"),r=n.val().trim(),i=W(".ipt-pic-secode"),s=i.val().trim();if(!tcb.validMobile(r)){n.shine4Error().focus();return}if(!s){i.shine4Error().focus();return}var o="/shangmen/doSendSmscode",u={mobile:r,secode:s};QW.Ajax.post(o,u,function(e){e=JSON.parse(e),e["errno"]=="205"?(alert(e.errmsg),$(".secode_img").attr("src","/secode/?rands="+Math.random())):e.errno?alert(e.errmsg):(W(".btn-get-secode").addClass("btn-get-secode-disabled").html("60\u79d2\u540e\u518d\u6b21\u53d1\u9001"),tcb.distimeAnim(60,function(e){e<=0?W(".btn-get-secode").removeClass("btn-get-secode-disabled").html("\u83b7\u53d6\u9a8c\u8bc1\u7801"):W(".btn-get-secode").html(e+"\u79d2\u540e\u518d\u6b21\u53d1\u9001")}))})},".extend-service-label":function(t){t.preventDefault();var n=W(this),r=n.query("input"),i=r.val();n.hasClass("extend-service-label-checked")?(n.removeClass("extend-service-label-checked"),r.attr("checked",!1),u()):e=tcb.panel("",W("#ZiYingExtendServiceConfirmPanelTpl").html().tmpl()({service_cnt:'<img src="'+window.__ExtendService[i].server_img_pc+'" alt=""/>',service_id:i}),{className:"extend-service-confirm-panel-wrap"});try{var s={cId:n.text()}}catch(o){}},".extend-service-confirm-panel .btn-confirm":function(t){t.preventDefault();var n=W(this),r=n.attr("data-serviceid");W(".extend-service-label").forEach(function(e){var t=W(e),n=t.query("input");n.val()==r&&(t.addClass("extend-service-label-checked"),n.attr("checked",!0))}),u(),e&&e.hide&&e.hide()},".extend-service-confirm-panel .btn-cancel":function(t){t.preventDefault(),e&&e.hide&&e.hide()}})}(),x(),T()}),Dom.ready(function(){function e(e){e=e||W("#formOrder");var i=!0,s=e.query(".curr-prd-box-extendinfo");if(s&&s.length){var o=s.query("select");o.forEach(function(e){var t=W(e);t.val()||(t.shine4Error(),i=!1)})}var u=e.query('[name="service_type"]'),a=0;u.forEach(function(e){W(e).attr("disabled")&&a++}),a>=u.length&&(i=!1,u.ancestorNode("label").shine4Error());var f=W(".service-type:checked");f.length?f.val()==1?i=t(i,e):f.val()==2?i=r(i,e):f.val()==3&&(i=n(i,e)):(i&&u.ancestorNode("label").shine4Error(),i=!1);var l=e.one('[name="fwsm"]'),c=l.ancestorNode(".service-agreement");return c.isVisible()&&!l.attr("checked")&&(c.shine4Error(),i=!1),i}function t(e,t){var n=t.one('.yyinfo-box-sm [name="sm_addr"]'),r=t.one('.yyinfo-box-sm [name="sm_time"]'),i=t.one('.yyinfo-box-sm [name="buyer_mobile"]'),s=t.one('.yyinfo-box-sm [name="sms_code"]');return n.val().trim()==""&&(n.shine4Error(),e=!1),r.val().trim()==""&&(r.shine4Error(),e=!1),tcb.validMobile(i.val())||(i.shine4Error(),e=!1),s.val().trim()==""&&(s.shine4Error(),e=!1),e}function n(e,t){var n=t.query('.yyinfo-box-dd [name="dd_addr"]'),r=t.one('.yyinfo-box-dd [name="sm_time"]'),i=t.one('.yyinfo-box-dd [name="buyer_mobile"]'),s=t.one('.yyinfo-box-dd [name="sms_code"]'),o=n.filter(function(e){return W(e).attr("checked")});return o.length||(n.ancestorNode("label").shine4Error(),e=!1),r.val().trim()==""&&(r.shine4Error(),e=!1),tcb.validMobile(i.val().trim())||(i.shine4Error(),e=!1),s.val().trim()==""&&(s.shine4Error(),e=!1),e}function r(e,t){var n=t.one(".addr-stations"),r=t.one('.yyinfo-box-yj [name="sm_addr"]'),i=t.one('.yyinfo-box-yj [name="sm_receiver"]'),s=t.one('.yyinfo-box-yj [name="buyer_mobile"]'),o=t.one('.yyinfo-box-yj [name="sms_code"]');return n.query(".active").length===0&&(n.query("li").shine4Error(),e=!1),r.val().trim()==""&&(r.shine4Error(),e=!1),i.val().trim()==""&&(i.shine4Error(),e=!1),tcb.validMobile(s.val())||(s.shine4Error(),e=!1),o.val().trim()==""&&(o.shine4Error(),e=!1),e}if(!W(".page-shangmen-order").length)return;W("#formOrder").on("submit",function(t){t.preventDefault();var n=W(this);if(tcb.isFormDisabled(n))return!1;tcb.setFormDisabled(n);if(!e(n))return tcb.releaseFormDisabled(n),!1;n.query(".yyinfo-box").filter(function(e){return!W(e).isVisible()}).query("input").attr("disabled",!0),QW.Ajax.post(this.action,this,function(e){try{e=JSON.parse(e);if(!e.errno){var t=e.result,r="/shangmen/pay_succ",i=t["need_pay"]=="1"?!0:!1;i&&(r="/shangmen/needPay"),window.location.href=r+"?order_id="+e.result.order_id}else alert("\u62b1\u6b49\uff0c\u51fa\u9519\u4e86\u3002"+e.errmsg),tcb.releaseFormDisabled(n);W(".yyinfo-box input").attr("disabled",!1)}catch(s){W(".yyinfo-box input").attr("disabled",!1),alert("\u7cfb\u7edf\u9519\u8bef\u8bf7\u5237\u65b0\u91cd\u8bd5"),tcb.releaseFormDisabled(n)}})}),$(function(){$(".reload_secode").on("click",function(e){$(".secode_img").attr("src","/secode/?rands="+Math.random())})})});